<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qui√©n Quiere Ser Enfermero</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        /* CSS (sin cambios) */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;500&display=swap');
        :root{--main-blue:#02022d;--dark-blue:#0c0c4c;--light-blue:#1e3a8a;--gold:#ffd700;--orange-select:#f9a825;--green-correct:#28a745;--red-incorrect:#dc3545;}
        html, body { height: 100%; margin: 0; }
        body{font-family:'Roboto',sans-serif;background:radial-gradient(circle, var(--light-blue) 0%, var(--main-blue) 70%);color:#fff;display:flex;justify-content:center;align-items:center;overflow:hidden;}
        .game-container{width:100%;height:100%;background:rgba(0,0,0,0.2);text-align:center;position:relative;display:flex;justify-content:center;align-items:center;}
        .screen{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:opacity 0.5s ease;background:radial-gradient(circle, var(--light-blue) 0%, var(--main-blue) 70%);z-index:10;padding: 15px; box-sizing: border-box;}
        .screen.active{opacity:1;visibility:visible;}
        #intro-screen{z-index:20; background:black; padding: 0;}
        #intro-video{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover; z-index: 21;}
        #start-overlay{position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:22; display:flex; justify-content:center; align-items:center; cursor:pointer;}
        .btn{font-family:'Orbitron',sans-serif;background:linear-gradient(135deg, var(--gold), var(--orange-select));color:var(--main-blue);border:none;padding:15px 30px;font-size:clamp(1rem, 4vw, 1.2rem);font-weight:700;border-radius:50px;cursor:pointer;transition:all 0.3s ease;margin-top:20px;box-shadow:0 4px 15px rgba(255,215,0,0.3);z-index:1;}
        .btn:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 6px 20px rgba(255,215,0,0.5);}
        .btn:disabled{background:#999;cursor:not-allowed;}
        #welcome-screen h1,#end-screen h2{font-family:'Orbitron',sans-serif;font-size:clamp(2rem, 8vw, 3rem);color:var(--gold);text-shadow:0 0 10px var(--gold);z-index:1; margin: 10px 0;}
        #welcome-screen h1 span{display:block;}
        #welcome-screen form{width:90%;max-width:500px;}
        .welcome-input{display:block;width:100%;box-sizing:border-box;margin:15px auto;padding:12px;border-radius:5px;border:1px solid #ccc;font-size:1rem;}
        #game-screen-wrapper{background:none;}
        #game-screen{width:100%;height:100%;display:grid;box-sizing:border-box; grid-template-columns: 1fr; grid-template-rows: auto auto 1fr; grid-template-areas: "prize" "logo" "qa"; gap: 10px; }
        #logo-container{grid-area:logo;display:flex;justify-content:center;align-items:center;}
        #logo-container img{width:auto;max-width:60%;max-height:10vh;object-fit:contain;}
        #qa-container{grid-area:qa;display:flex;flex-direction:column;justify-content:space-evenly;align-items:center; min-height: 0;}
        #prize-ladder{grid-area:prize;background:rgba(0,0,0,0.4);border-radius:10px;padding:5px;}
        #prize-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:row;justify-content:center;gap:5px;height:100%;}
        #prize-list li{flex-grow:1;display:flex;align-items:center;justify-content:center;padding:5px;font-family:'Orbitron',sans-serif;color:rgba(255,255,255,0.7);transition:all 0.3s ease;border-radius:5px; font-size: 0.7rem; white-space: nowrap;}
        #prize-list li.current{background-color:var(--orange-select);color:var(--main-blue);font-weight:700;transform:scale(1.1);box-shadow:0 0 15px var(--orange-select);}
        #prize-list li span:first-child{color:var(--gold);margin-right:5px;}
        #level-title{font-family:'Orbitron',sans-serif;font-size:clamp(1.2rem, 5vw, 1.8rem);color:var(--gold);margin: 10px 0;text-shadow:0 0 8px var(--gold);}
        #question-box{width:95%;height:auto;min-height:80px;background:linear-gradient(180deg, var(--main-blue), var(--dark-blue));border:2px solid var(--gold);border-radius:10px;display:flex;justify-content:center;align-items:center;font-size:clamp(1rem, 4vw, 1.4rem);padding:15px;margin-bottom:15px;clip-path:polygon(0% 50%, 5% 0%, 95% 0%, 100% 50%, 95% 100%, 5% 100%);}
        #options-grid{width:95%;display:grid;grid-template-columns:1fr;gap:10px;}
        .option-box{background:linear-gradient(180deg, var(--main-blue), var(--dark-blue));border:2px solid var(--gold);color:#fff;font-size:clamp(0.9rem, 3.5vw, 1.2rem);border-radius:10px;cursor:pointer;transition:all 0.2s ease;text-align:left;padding:12px 20px;clip-path:polygon(0% 50%, 8% 0%, 92% 0%, 100% 50%, 92% 100%, 8% 100%);}
        #lives-display{position:absolute;top:15px;left:15px;font-size:1.2rem;font-family:'Orbitron';}
        #lives-display span{font-size:1.5rem;margin-left:5px;color:var(--red-incorrect);text-shadow:0 0 5px var(--red-incorrect);}
        @media (min-width: 768px) { #game-screen { grid-template-columns: 1fr 250px; grid-template-rows: 120px 1fr; grid-template-areas: "logo prize" "qa   prize"; gap: 20px; padding: 20px; } #qa-container { justify-content: center; } #logo-container img { max-height: 100px; max-width: 80%; } #prize-list { flex-direction:column-reverse; gap:0;} #prize-list li { padding: 0 15px; font-size: 1rem; justify-content: flex-start;} #prize-list li span:first-child { margin-right: 15px; } #options-grid { grid-template-columns: 1fr 1fr; gap:15px; } }
        .option-box:hover{background:var(--light-blue);}.option-prefix{color:var(--orange-select);font-family:'Orbitron',sans-serif;margin-right:15px;}.option-box.selected{background:var(--orange-select);color:var(--main-blue);font-weight:bold;animation:pulse-select 1.2s infinite;}.option-box.correct{background:var(--green-correct);animation:flash-correct 1s;}.option-box.incorrect{background:var(--red-incorrect);animation:shake-incorrect 0.5s;}@keyframes pulse-select{0%,100%{transform:scale(1);}50%{transform:scale(1.02);}}@keyframes flash-correct{0%,100%{opacity:1;}50%{opacity:0.3;}}@keyframes shake-incorrect{0%,100%{transform:translateX(0);}10%,30%,50%,70%,90%{transform:translateX(-8px);}20%,40%,60%,80%{transform:translateX(8px);}}
        #leaderboard-container{margin-top:20px;width:90%;max-width:600px;text-align:left;}#leaderboard-list{list-style:none;padding:0;}#leaderboard-list li{background:rgba(0,0,0,0.3);padding:10px 15px;border-radius:5px;margin-bottom:8px;display:flex;justify-content:space-between;font-weight:500; font-size: clamp(0.8rem, 3vw, 1rem);}#leaderboard-list li.current-player{background:var(--gold);color:var(--main-blue);font-weight:700;}#final-rank{font-size:clamp(1rem, 4vw, 1.3rem);color:var(--gold);margin-top:5px;font-weight:700;}
    </style>
</head>
<body>
    <div class="game-container">
        <!-- HTML sin cambios -->
        <div id="intro-screen" class="screen active"> <div id="start-overlay"><button class="btn">Hacer Clic para Empezar</button></div> <video id="intro-video" src="https://somnozzz.cl/wp-content/uploads/2025/06/QQSM.mp4" muted playsinline></video> </div>
        <div id="welcome-screen" class="screen"><h1>QUI√âN QUIERE SER<br><span>ENFERMERO</span></h1><p>Ingresa tus datos para comenzar. Tienes 3 intentos.</p><form id="register-form"><input type="text" id="player-name" class="welcome-input" placeholder="Tu Nombre y Apellido" required><input type="text" id="player-service" class="welcome-input" placeholder="Tu Servicio / √Årea de Trabajo" required><button type="submit" id="start-btn" class="btn">¬°Comenzar a Jugar!</button></form></div>
        <div id="game-screen-wrapper" class="screen"> <div id="lives-display"></div> <div id="game-screen"> <div id="logo-container"><img src="https://somnozzz.cl/wp-content/uploads/2025/06/QQSM.png" alt="Logo del Juego"></div> <div id="qa-container"><h2 id="level-title"></h2><div id="question-box"></div><div id="options-grid"></div></div> <div id="prize-ladder"><ol id="prize-list" reversed></ol></div> </div> </div>
        <div id="end-screen" class="screen"> <h2 id="end-message"></h2> <p id="final-score"></p> <p id="final-rank"></p> <div id="leaderboard-container"> <h2>üèÜ Top 10 Jugadores üèÜ</h2> <ol id="leaderboard-list"></ol> <button id="restart-btn" class="btn">Jugar de Nuevo</button> </div> </div>
    </div>
    <audio id="intro-sound" src="https://somnozzz.cl/wp-content/uploads/2025/06/Pregunta-Quien-quiere-ser-millonario_-Sound-Effect.mp3" preload="auto"></audio><audio id="question-start-sound" src="https://www.myinstants.com/media/sounds/empezar-pregunta-quien-quiere-ser-millonario.mp3" preload="auto"></audio><audio id="background-music" src="https://somnozzz.cl/wp-content/uploads/2025/06/Quien-Quiere-Ser-Millonario-Efecto-de-Sonido.mp3" preload="auto" loop></audio><audio id="correct-sound" src="https://www.myinstants.com/media/sounds/es-correcto.mp3" preload="auto"></audio><audio id="incorrect-sound" src="https://www.myinstants.com/media/sounds/sonido-de-error-de-windows-xp-fatal-error.mp3" preload="auto"></audio>

    <script>
        const GOOGLE_SCRIPT_URL = "PEGA_AQUI_TU_URL_DEL_SCRIPT_DE_GOOGLE";

        const FULL_QUESTION_BANK = [
            { question: "En derrame pleural neopl√°sico sin fuga a√©rea, ¬øqu√© aspiraci√≥n se recomienda?", options: ["Mantener aspiraci√≥n continua a ‚Äì20 cm H‚ÇÇO", "No usar aspiraci√≥n salvo falta de re-expansi√≥n, luego ajustar a ‚Äì15 cm H‚ÇÇO", "Cambiar a drenaje seco sin sello de agua", "Usar aspiraci√≥n intermitente con sello valvular"], correct: 1 }, { question: "En un cat√©ter de l√≠nea media, ¬øqu√© complicaci√≥n es un cord√≥n eritematoso y doloroso?", options: ["Trombosis", "Extravasaci√≥n", "Flebitis", "Obstrucci√≥n"], correct: 2 }, { question: "Seg√∫n el Manual de Acreditaci√≥n, ¬øqu√© umbral de cumplimiento se exige al prestador?", options: ["50%", "60%", "70%", "80%"], correct: 2 }, { question: "¬øCu√°l es la contraindicaci√≥n absoluta para instalar una pleurostom√≠a?", options: ["Coagulopat√≠a con plaquetas <50.000/ŒºL", "Infecci√≥n en el sitio de inserci√≥n", "Adherencias extensas entre pleuras", "Neumot√≥rax a tensi√≥n"], correct: 2 }, { question: "De las complicaciones de un cat√©ter de l√≠nea media, ¬øcu√°l NO es habitual?", options: ["Flebitis", "Extravasaci√≥n", "Trombosis", "Embolia pulmonar"], correct: 3 }, { question: "En la NT 21.372 sobre acompa√±amiento, ¬øcu√°l es un objetivo espec√≠fico?", options: ["Incrementar jornada laboral", "Normar est√°ndares m√≠nimos para acompa√±amiento", "Reducir n√∫mero de camas", "Centralizar la atenci√≥n"], correct: 1 }, { question: "Prevenci√≥n de IAAS para sondaje vesical (Clase IB), ¬øqu√© indicaci√≥n de higiene es?", options: ["Aseo genital con antis√©ptico especial", "Higiene diaria de genitales con agua y jab√≥n", "Ba√±o completo cada 3 d√≠as", "Enjuague con soluci√≥n salina est√©ril"], correct: 1 }, { question: "Para canalizar venas profundas del brazo con ultrasonido, ¬øqu√© t√©cnica es preferida?", options: ["Broca cut√°nea", "T√©cnica Seldinger cl√°sica", "T√©cnica de √°ngulo fijo", "T√©cnica de punci√≥n m√∫ltiple"], correct: 1 }, { question: "Seg√∫n protocolo IAAS, ¬øqu√© evidencia respalda la evaluaci√≥n diaria de permanencia de sonda vesical?", options: ["Clase IA", "Clase IB", "Categor√≠a II", "Buenas pr√°cticas"], correct: 1 }, { question: "En lavado de cat√©ter de l√≠nea media con m√©todo push-stop-push, ¬øqu√© volumen se usa?", options: ["5 ml de cloruro de sodio", "10 ml de suero fisiol√≥gico con presi√≥n positiva", "20 ml de heparina", "2 ml de lidoca√≠na"], correct: 1 }, { question: "Seg√∫n Manual de Acreditaci√≥n, ¬øqu√© √°mbito eval√∫a la habilitaci√≥n y competencias del personal?", options: ["Gesti√≥n Cl√≠nica", "Registros", "Competencias del Recurso Humano", "Servicios de Apoyo"], correct: 2 }, { question: "Para nutrici√≥n parenteral por midline, ¬øqu√© osmolaridad m√°xima se permite?", options: ["< 600 mOsm/L", "< 700 mOsm/L", "< 800-850 mOsm/L", "< 1000 mOsm/L"], correct: 2 }, { question: "Seg√∫n Estrategia Hospital Amigo, ¬øcu√°l de estos servicios contempla visita las 24 horas?", options: ["Traumatolog√≠a", "Unidad de Cuidados Intensivos", "Pediatr√≠a", "Psiquiatr√≠a"], correct: 2 }, { question: "¬øCu√°l es el objetivo del manejo de pleurostom√≠as?", options: ["Incrementar presi√≥n intrapleural", "Restablecer presi√≥n negativa y vaciar cavidad", "Evitar ultrafiltraci√≥n linf√°tica", "Reducir producci√≥n de l√≠quido pleural"], correct: 1 }, { question: "Prevenci√≥n de IAAS para sondaje vesical, ¬øqu√© pr√°ctica es fundamental?", options: ["Mantener sistema debajo del nivel de la vejiga", "Rotar la bolsa cada 8 h", "Exponer el tubo al aire", "Usar bolsa sin puerto de muestreo"], correct: 0 }, { question: "En la fijaci√≥n de un cat√©ter de l√≠nea media, ¬øqu√© m√©todo sin sutura se menciona?", options: ["Suturas simples", "Adhesivo o anclaje subcut√°neo", "Cinta microporosa", "Collar esternal"], correct: 1 }, { question: "Seg√∫n NT 21.372, ¬øcu√°l opci√≥n NO es motivo para suspender el acompa√±amiento?", options: ["Cat√°strofe por Estado de Excepci√≥n", "Alerta sanitaria por epidemia", "Evento de seguridad p√∫blica", "Falta de estacionamiento para familiares"], correct: 3 }, { question: "Seg√∫n ecuaci√≥n de Fanning, ¬øqu√© di√°metro interno m√≠nimo se sugiere para un flujo de 15 l/min?", options: ["4 mm", "6 mm", "8 mm", "10 mm"], correct: 1 }, { question: "Seg√∫n American Thoracic Society, ¬øqu√© hallazgo ecogr√°fico especifica un derrame pleural exudativo?", options: ["Ausencia de septos pleurales", "Presencia de hebras fibrinosas", "Colapso pulmonar subyacente", "Aire libre en cavidad pleural"], correct: 1 }, { question: "En obstrucci√≥n por co√°gulos de un cat√©ter de l√≠nea media, ¬øqu√© agente se sugiere?", options: ["Insuflar aire", "Uroquinasa (m√°x. 10.000 U) o etanol", "Clorhexidina", "Cloruro de potasio"], correct: 1 }, { question: "En manejo de hemot√≥rax post-cirug√≠a tor√°cica, ¬øqu√© presi√≥n de aspiraci√≥n se mantiene?", options: ["0 cm H‚ÇÇO", "-5 cm H‚ÇÇO", "-15 cm H‚ÇÇO", "-25 cm H‚ÇÇO"], correct: 2 }, { question: "En componente RH 2.1 del Manual de Acreditaci√≥n, ¬øqu√© programa debe tener el prestador?", options: ["Programas de mejor√≠a continua", "Programas de inducci√≥n en seguridad", "Equipamiento de √∫ltima generaci√≥n", "Protocolo de emergencias"], correct: 1 }, { question: "Para la primera acreditaci√≥n, ¬øqu√© porcentaje m√≠nimo de caracter√≠sticas debe cumplir el prestador?", options: ["30%", "50%", "70%", "95%"], correct: 1 }, { question: "En la elecci√≥n de venas para inserci√≥n de midline, ¬øcu√°l de estas NO es preferida?", options: ["Vena bas√≠lica", "Vena braquial", "Vena cef√°lica", "Vena yugular interna"], correct: 3 }, { question: "Para infiltrar anest√©sico en pleurostom√≠a, ¬øqu√© agente y concentraci√≥n se recomienda?", options: ["Bupivaca√≠na al 0,25%", "Lidoca√≠na al 1-2%", "Ropivaca√≠na al 0,5%", "Mepivaca√≠na al 3%"], correct: 1 }, { question: "Seg√∫n NT 21.372, ¬øqui√©n supervisa la implementaci√≥n de la norma en la red asistencial?", options: ["Ministerio de Salud", "Superintendencia de Salud", "Servicios de Salud", "Direcci√≥n del Hospital"], correct: 2 }, { question: "En protocolo de l√≠nea media, ¬øcu√°l es la longitud t√≠pica de un midline midclavicular?", options: ["10-15 cm", "15-20 cm", "20-25 cm", "> 30 cm"], correct: 2 }, { question: "En el registro REG 1.1 del Manual de Acreditaci√≥n, ¬øqu√© garantiza este registro?", options: ["Certificaci√≥n ISO", "Ficha cl√≠nica √∫nica individual", "Evaluaci√≥n pre-quir√∫rgica", "Historia de vida del paciente"], correct: 1 }, { question: "Ante sospecha de trombosis en cat√©ter de l√≠nea media, ¬øqu√© acci√≥n se debe tomar?", options: ["Inyectar trombol√≠ticos", "Avisar al m√©dico y realizar eco-Doppler", "Continuar uso normal", "Cambiar de cat√©ter sin estudios"], correct: 1 }, { question: "Seg√∫n Gu√≠a CDC para prevenci√≥n de ITU, ¬øqu√© medida es categor√≠a IB?", options: ["Cambio rutinario del cat√©ter cada 72 h", "Mantener un sistema de drenaje cerrado", "Realizar irrigaci√≥n diaria del cat√©ter", "Uso de cat√©ter recubierto de plata"], correct: 1 }, { question: "En Estrategia Hospital Amigo (UCI 16:00-17:30h), ¬øcu√°ntas personas pueden ingresar simult√°neamente?", options: ["Una", "Dos", "Tres", "Cuatro"], correct: 2 }, { question: "En √°mbito GCL 1.1 del Manual de Acreditaci√≥n, ¬øqu√© pr√°ctica es evaluada?", options: ["Indicadores de seguridad", "Evaluaci√≥n pre-anest√©sica", "Programas de inducci√≥n", "Registro estandarizado de fichas"], correct: 1 }, { question: "Para el sellado final de un cat√©ter midline, ¬øqu√© agente se recomienda?", options: ["Heparina", "Citrato o suero fisiol√≥gico", "Clorhexidina alcoh√≥lica", "Drenaje seco"], correct: 1 }, { question: "Para inserci√≥n de midline, ¬øqu√© caracter√≠stica venosa es una contraindicaci√≥n?", options: ["Venas de buen calibre", "Ausencia de flebitis", "Venas trombosadas o varicosas", "Trayecto recto de la vena"], correct: 2 }, { question: "Seg√∫n panel RAND/UCLA, ¬øtiempo m√°ximo de permanencia recomendado para cat√©ter midline?", options: ["7 d√≠as", "14 d√≠as", "21 d√≠as", "30 d√≠as"], correct: 1 }, { question: "En instalaci√≥n de drenaje pleural, ¬øcu√°l es el sitio anat√≥mico de instalaci√≥n por defecto?", options: ["4¬∫ espacio intercostal, l√≠nea axilar posterior", "5¬∫ espacio intercostal, tri√°ngulo de seguridad", "6¬∫ espacio intercostal, l√≠nea media anterior", "7¬∫ espacio intercostal, l√≠nea escapular"], correct: 1 }, { question: "En caso de extravasaci√≥n por cat√©ter de l√≠nea media, ¬øcu√°l es la acci√≥n inicial?", options: ["Aumentar velocidad de infusi√≥n", "Detener la infusi√≥n", "Cambiar a v√≠a oral", "Administrar vasopresores"], correct: 1 }, { question: "En Manual de Acreditaci√≥n, ¬øqu√© √°mbito corresponde a la pol√≠tica de mejor√≠a continua (CAL 1.1)?", options: ["Gesti√≥n Cl√≠nica", "Gesti√≥n de la Calidad", "Acceso, Oportunidad y Continuidad", "Registros"], correct: 1 }, { question: "Para prevenir sedimentaci√≥n de orina en drenaje vesical, ¬øqu√© pr√°ctica se debe realizar?", options: ["Elevar bolsa sobre la vejiga", "Acomodar el tubo a favor de la gravedad", "Cambiar sistema cada 12 h", "Usar gel anticoagulante"], correct: 1 }, { question: "Ante obstrucci√≥n de cat√©ter de l√≠nea media, ¬øcu√°l es el primer paso?", options: ["Retirar inmediatamente el cat√©ter", "Aspirar suavemente y luego lavar con suero", "Inyectar heparina", "Administrar antihistam√≠nicos"], correct: 1 }, { question: "Para drenaje pleural, ¬øcu√°l NO es una indicaci√≥n para el procedimiento?", options: ["Neumot√≥rax sintom√°tico", "Derrame pleural neopl√°sico", "Quilot√≥rax", "Derrame pleural asintom√°tico con <1 cm"], correct: 3 }, { question: "Seg√∫n Estrategia Hospital Amigo, ¬øcu√°l es el eje principal del programa?", options: ["El personal de salud", "El usuario hospitalizado", "La gesti√≥n administrativa", "El financiamiento"], correct: 1 }, { question: "Sin sistema cerrado prefabricado para sondaje vesical, ¬øqu√© se recomienda?", options: ["Sistema de aspiraci√≥n continua", "Sonda, bolsa con puerto y v√°lvula antirreflujo", "Gasa est√©ril y jeringa con aguja", "Bolsa sin puerto para muestrear"], correct: 1 }, { question: "En normatividad de Estrategia Hospital Amigo, ¬øen qu√© ley se apoya?", options: ["Ley 18.834", "Ley 21.050", "Ley 20.584", "Ley 19.882"], correct: 2 }, { question: "Seg√∫n OMS, ¬øcu√°ntos 'building blocks' definen la estructura de un sistema de salud?", options: ["Cuatro", "Cinco", "Seis", "Siete"], correct: 2 }, { question: "En protocolo de l√≠nea media, ¬øqu√© m√©todo ecogr√°fico se usa para mapear venas?", options: ["Doppler color", "RaPeVA", "Eco en M-mode", "Eco 3D"], correct: 1 }, { question: "En manejo post-pleurostom√≠a, ¬ød√©bito m√°ximo diario para retiro de drenaje pleural?", options: ["< 100 cc/d√≠a", "< 200 cc/d√≠a", "< 300 cc/d√≠a", "< 450 cc/d√≠a"], correct: 1 }, { question: "En manejo de derrame pleural neopl√°sico, ¬øqu√© rango de calibre de tubo se recomienda?", options: ["10-12 Fr", "14-24 Fr", "28-32 Fr", "> 36 Fr"], correct: 1 }, { question: "En mantenimiento de cat√©ter de l√≠nea media, ¬øcada cu√°nto se realizan las curas?", options: ["Cada 3-5 d√≠as", "Cada 7-10 d√≠as", "Cada 14-21 d√≠as", "Solo al presentar complicaciones"], correct: 1 }, { question: "En paciente pedi√°trico cr√≠tico, ¬øconcentraci√≥n m√°xima de aciclovir para infusi√≥n continua?", options: ["5 mg/ml", "7 mg/ml", "10 mg/ml", "15 mg/ml"], correct: 0 }, { question: "Para minimizar riesgo de nefrotoxicidad con aminofilina, ¬øqu√© factor se controla?", options: ["Tiempo de adm. > 30 min", "Concentraci√≥n final > 25 mg/ml", "Velocidad de adm. m√°x. de 20 mg/min", "Uso concomitante de furosemida"], correct: 2 }, { question: "Seg√∫n Manual Farmacolog√≠a, ¬øestabilidad m√°xima de vancomicina reconstituida a temp. ambiente?", options: ["4 horas", "12 horas", "24 horas", "48 horas"], correct: 2 }, { question: "En infusi√≥n de alb√∫mina al 20%, ¬øcu√°l es la principal contraindicaci√≥n del fabricante?", options: ["Hipertensi√≥n arterial", "Insuficiencia renal", "Reacci√≥n al√©rgica previa a alb√∫mina", "Edema pulmonar agudo"], correct: 2 }, { question: "En el uso de propofol, ¬øqu√© caracter√≠stica de su emulsionante favorece la estabilidad microbiol√≥gica?", options: ["pH √°cido", "Presencia de emulsionantes esterificados", "Bajo contenido graso", "Ausencia de conservantes"], correct: 1 }, { question: "Al mapear para un PICC (RaPeVA/RaCeVA), ¬øqu√© grupo de venas se prefiere emplear?", options: ["Vena cef√°lica, bas√≠lica, braquial", "Vena braquial, femoral, subclavia", "Vena bas√≠lica, braquial, cef√°lica", "Vena yugular interna, subclavia, bas√≠lica"], correct: 2 }, { question: "Al comprobar la punta del PICC con ECG, ¬øqu√© cambio en la onda P indica que pas√≥ la uni√≥n cavo-auricular?", options: ["Disminuci√≥n de amplitud", "Bifasicidad con componente negativo", "Aparici√≥n de onda U", "Aplanamiento de la onda T"], correct: 1 }, { question: "Para el sellado final del PICC, ¬øqu√© volumen se usa en relaci√≥n al volumen muerto del cat√©ter?", options: ["50%", "100%", "120%", "150%"], correct: 2 }, { question: "En mantenimiento del PICC, ¬øcada cu√°nto se cambia el ap√≥sito est√©ril si no est√° sucio?", options: ["Cada 3-5 d√≠as", "Cada 7-10 d√≠as", "Cada 14-21 d√≠as", "Solo al presentar secreci√≥n"], correct: 1 }, { question: "Seg√∫n Protocolo PICC, ¬øcu√°l es la complicaci√≥n m√°s frecuente asociada?", options: ["Trombosis", "Flebitis", "Extravasaci√≥n", "Rotura del cat√©ter"], correct: 1 }, { question: "Seg√∫n Ley Karin (21.643), ¬øqu√© nuevos riesgos debe identificar el empleador?", options: ["Riesgos ergon√≥micos", "Riesgos psicosociales de acoso y violencia", "Riesgos biol√≥gicos", "Riesgos de accidentes de tr√°nsito"], correct: 1 }, { question: "Seg√∫n Ley 21.643, ¬øqu√© medida es obligatoria para empleadores sin Reglamento Interno?", options: ["Encuestas anuales de clima", "Poner por escrito el protocolo de prevenci√≥n", "Capacitar en primeros auxilios", "Elaborar estad√≠sticas de rotaci√≥n"], correct: 1 }, { question: "En investigaci√≥n interna (Ley 21.643), ¬øplazo m√°ximo para concluir la pesquisa?", options: ["10 d√≠as", "20 d√≠as", "30 d√≠as", "45 d√≠as"], correct: 2 }, { question: "En procedimientos de investigaci√≥n (Ley Karin), ¬øqu√© principio NO forma parte?", options: ["Confidencialidad", "Imparcialidad", "Celeridad", "Publicidad de resultados"], correct: 3 }, { question: "Seg√∫n directrices de SUSESO, ¬øcon qu√© frecuencia se informan los canales de denuncia?", options: ["Anualmente", "Semestralmente", "Trimestralmente", "Mensualmente"], correct: 0 }
        ];

        // --- DOM, ESTADO DEL JUEGO Y SONIDO --- (sin cambios)
        const allScreens = document.querySelectorAll('.screen'); const welcomeScreen = document.getElementById('welcome-screen'); const gameScreenWrapper = document.getElementById('game-screen-wrapper'); const endScreen = document.getElementById('end-screen'); const registerForm = document.getElementById('register-form'); const restartBtn = document.getElementById('restart-btn'); const livesDisplay = document.getElementById('lives-display'); const levelTitle = document.getElementById('level-title'); const questionBox = document.getElementById('question-box'); const optionsGrid = document.getElementById('options-grid'); const prizeList = document.getElementById('prize-list'); const endMessage = document.getElementById('end-message'); const finalScore = document.getElementById('final-score'); const finalRank = document.getElementById('final-rank'); const leaderboardList = document.getElementById('leaderboard-list'); const backgroundMusic = document.getElementById('background-music'); const questionStartSound = document.getElementById('question-start-sound');
        let gameLevels = [], lastQuestionObject = null, currentQuestionObject = {};
        let currentLevel = 0, lives = 3, totalScore = 0, selectedAnswer = false;
        let currentPlayerName = '', currentPlayerService = '';
        function playSound(sound){try { sound.currentTime=0; sound.play(); } catch (e) { console.error("Error al reproducir sonido:", e); }}
        function stopAllSounds(){document.querySelectorAll('audio').forEach(sound=>{sound.pause();sound.currentTime=0;});}
        function switchScreen(activeScreen){allScreens.forEach(screen=>screen.classList.remove('active'));activeScreen.classList.add('active');}
        
        // --- INICIALIZACI√ìN Y FLUJO DEL JUEGO ---
        function init() {
            const startOverlay = document.getElementById('start-overlay');
            const introVideo = document.getElementById('intro-video');
            startOverlay.addEventListener('click', () => {
                startOverlay.style.display = 'none';
                introVideo.muted = false;
                introVideo.play();
            });
            introVideo.addEventListener('ended', () => switchScreen(welcomeScreen));
            introVideo.addEventListener('error', () => switchScreen(welcomeScreen));
            registerForm.addEventListener('submit', handleRegisterSubmit);
            restartBtn.addEventListener('click', resetGame);
        }

        function resetGame() { currentLevel=0; lives=3; totalScore=0; gameLevels=[]; lastQuestionObject=null; document.getElementById('player-name').value=''; document.getElementById('player-service').value=''; const startBtn=document.getElementById('start-btn'); startBtn.disabled=false; startBtn.textContent='¬°Comenzar a Jugar!'; switchScreen(welcomeScreen); }
        function handleRegisterSubmit(e) { e.preventDefault(); currentPlayerName=document.getElementById('player-name').value; currentPlayerService=document.getElementById('player-service').value; if (!currentPlayerName||!currentPlayerService){alert("Por favor, completa tu nombre y servicio.");return;} const startBtn=document.getElementById('start-btn'); startBtn.disabled=true; startBtn.textContent='Cargando...'; startGame(); }
        function startGame() { stopAllSounds(); playSound(backgroundMusic); const shuffledQuestions=[...FULL_QUESTION_BANK].sort(()=>0.5-Math.random()); gameLevels=[]; const levelDistribution = [13, 13, 13, 13, 12]; for (let i=0; i<5; i++) { gameLevels.push({level:i+1, questions:shuffledQuestions.splice(0,levelDistribution[i])}); } currentLevel=0; lives=3; totalScore=0; selectedAnswer=false; lastQuestionObject=null; prizeList.innerHTML=''; gameLevels.forEach((levelData)=>{const li=document.createElement('li');li.id=`level-${levelData.level-1}`;li.innerHTML=`<span>${levelData.level}</span> NIVEL ${levelData.level}`;prizeList.appendChild(li);}); switchScreen(gameScreenWrapper); loadQuestion(); }
        function loadQuestion() { if (currentLevel>=gameLevels.length){winGame();return;} playSound(questionStartSound); selectedAnswer=false; updateHUD(); const levelData=gameLevels[currentLevel]; let availableQuestions=levelData.questions; if(lastQuestionObject&&availableQuestions.length>1){availableQuestions=availableQuestions.filter(q=>q.question!==lastQuestionObject.question);} const questionIndex=Math.floor(Math.random()*availableQuestions.length); currentQuestionObject=availableQuestions[questionIndex]; questionBox.innerText=currentQuestionObject.question; optionsGrid.innerHTML=""; const prefixes=['A','B','C','D']; currentQuestionObject.options.forEach((option,index)=>{const button=document.createElement('button');button.classList.add('option-box');button.innerHTML=`<span class="option-prefix">${prefixes[index]}:</span> ${option}`;button.addEventListener('click',()=>selectAnswer(index,button));optionsGrid.appendChild(button);}); }
        function selectAnswer(selectedIndex,button) { if(selectedAnswer)return; selectedAnswer=true; if(backgroundMusic)backgroundMusic.volume=0.3; const buttons=optionsGrid.getElementsByTagName('button'); button.classList.add('selected'); setTimeout(()=>{ if(backgroundMusic)backgroundMusic.volume=1.0; if(selectedIndex===currentQuestionObject.correct){ playSound(document.getElementById('correct-sound')); button.classList.remove('selected'); button.classList.add('correct'); totalScore++; currentLevel++; lastQuestionObject=null; setTimeout(loadQuestion,1800); } else { playSound(document.getElementById('incorrect-sound')); lives--; lastQuestionObject=currentQuestionObject; button.classList.remove('selected'); button.classList.add('incorrect'); buttons[currentQuestionObject.correct].classList.add('correct'); setTimeout(()=>{if(lives<=0){endGame();}else{loadQuestion();}},2500); } },2000); }
        function updateHUD() { livesDisplay.innerHTML='Intentos: '+'‚ù§Ô∏è'.repeat(lives); levelTitle.innerText=`NIVEL ${currentLevel+1}`; const prizeItems=prizeList.getElementsByTagName('li'); for(let i=0;i<prizeItems.length;i++){prizeItems[i].classList.remove('current');} if(currentLevel<gameLevels.length){document.getElementById(`level-${currentLevel}`).classList.add('current');} }
        function winGame() { handleGameEnd(true); }
        function endGame() { handleGameEnd(false); }

        // --> FUNCI√ìN handleGameEnd CORREGIDA Y VALIDADA
        async function handleGameEnd(isWinner) {
            stopAllSounds();
            endMessage.textContent = isWinner ? "¬°FELICIDADES, HAS GANADO!" : "¬°JUEGO TERMINADO!";
            finalScore.innerText = `Tu puntaje final es: ${totalScore} Puntos`;
            finalRank.textContent = '';
            leaderboardList.innerHTML = "<li>Guardando tu puntaje y actualizando el ranking...</li>";
            switchScreen(endScreen);

            if (typeof confetti === 'function') {
                const duration = 2 * 1000; const end = Date.now() + duration;
                (function frame() {
                    confetti({particleCount: 2, angle: 60, spread: 55, origin: { x: 0 }});
                    confetti({particleCount: 2, angle: 120, spread: 55, origin: { x: 1 }});
                    if (Date.now() < end) { requestAnimationFrame(frame); }
                }());
            }

            const newScoreEntry = { name: currentPlayerName, service: currentPlayerService, score: totalScore, id: Date.now() };

            try {
                // Hacemos una √∫nica llamada POST que guarda y devuelve el historial completo
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(newScoreEntry),
                });
                
                if (!response.ok) {
                    throw new Error(`Error en la respuesta de la red: ${response.statusText}`);
                }

                const fullLog = await response.json();
                displayLeaderboard(fullLog, newScoreEntry.id);

            } catch (error) {
                console.error("Error al conectar con el ranking:", error);
                leaderboardList.innerHTML = "<li>Hubo un error al conectar con el ranking. Revisa la consola (F12) para m√°s detalles.</li>";
            }
        }
        
        function displayLeaderboard(fullLog, currentPlayerId) {
            leaderboardList.innerHTML = "";
            const leaderboardData = [...fullLog].sort((a, b) => b.puntaje - a.puntaje).slice(0, 10);

            if (leaderboardData.length === 0) {
                leaderboardList.innerHTML = "<li>A√∫n no hay puntajes.</li>";
                finalRank.textContent = "¬°Felicitaciones por ser el primero!";
                return;
            }

            const playerIndex = leaderboardData.findIndex(score => score.id === currentPlayerId);
            if (playerIndex !== -1) {
                const rank = playerIndex + 1;
                finalRank.textContent = `¬°Lograste el puesto #${rank} en el Top 10!`;
            } else {
                finalRank.textContent = "¬°Buen intento! Sigue jugando para entrar al Top 10.";
            }
            
            leaderboardData.forEach((score, index) => {
                const li = document.createElement('li');
                const scoreText = `${score.puntaje} Puntos`;
                li.innerHTML = `<span>#${index + 1} ${score.nombre} (${score.servicio || ''})</span><span>${scoreText}</span>`;
                if (score.id === currentPlayerId) {
                    li.classList.add('current-player');
                }
                leaderboardList.appendChild(li);
            });
        }

        init();
    </script>
</body>
</html>
