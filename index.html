<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="handheldfriendly" content="true">
    <meta name="mobileoptimized" content="width">
    <title>Qui茅n Quiere Ser Enfermero</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        /* CSS optimizado para m贸viles */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;500&display=swap');
        :root {
            --main-blue: #02022d;
            --dark-blue: #0c0c4c;
            --light-blue: #1e3a8a;
            --gold: #ffd700;
            --orange-select: #f9a825;
            --green-correct: #28a745;
            --red-incorrect: #dc3545;
        }
        
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background: radial-gradient(circle, var(--light-blue) 0%, var(--main-blue) 70%);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            -webkit-overflow-scrolling: touch;
        }
        
        .game-container {
            width: 100%;
            height: 100%;
            max-width: 100vw;
            max-height: 100vh;
            background: rgba(0,0,0,0.2);
            text-align: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease;
            background: radial-gradient(circle, var(--light-blue) 0%, var(--main-blue) 70%);
            z-index: 10;
            padding: 15px;
            box-sizing: border-box;
            width: 100%;
            height: 100%;
            overflow-y: auto;
        }
        
        .screen.active {
            opacity: 1;
            visibility: visible;
        }
        
        #intro-screen {
            z-index: 20;
            background: black;
            padding: 0;
        }
        
        #intro-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 21;
        }
        
        #start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 22;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            touch-action: manipulation;
        }
        
        .btn {
            font-family: 'Orbitron', sans-serif;
            background: linear-gradient(135deg, var(--gold), var(--orange-select));
            color: var(--main-blue);
            border: none;
            padding: 12px 25px;
            font-size: clamp(1rem, 5vw, 1.3rem);
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(255,215,0,0.3);
            z-index: 1;
            width: 90%;
            max-width: 300px;
            touch-action: manipulation;
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(255,215,0,0.5);
        }
        
        .btn:disabled {
            background: #999;
            cursor: not-allowed;
        }
        
        #welcome-screen h1, #end-screen h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.5rem, 8vw, 2.5rem);
            color: var(--gold);
            text-shadow: 0 0 10px var(--gold);
            z-index: 1;
            margin: 10px 0;
            line-height: 1.2;
        }
        
        #welcome-screen h1 span {
            display: block;
        }
        
        #welcome-screen p {
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            margin: 10px 15px;
        }
        
        #welcome-screen form {
            width: 95%;
            max-width: 500px;
        }
        
        .welcome-input {
            display: block;
            width: 100%;
            box-sizing: border-box;
            margin: 12px auto;
            padding: 12px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: clamp(0.9rem, 4vw, 1.1rem);
        }
        
        #game-screen-wrapper {
            background: none;
        }
        
        #game-screen {
            width: 100%;
            height: 100%;
            display: grid;
            box-sizing: border-box;
            grid-template-columns: 1fr;
            grid-template-rows: auto auto 1fr;
            grid-template-areas: 
                "prize"
                "logo"
                "qa";
            gap: 10px;
            padding: 10px;
        }
        
        #logo-container {
            grid-area: logo;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px 0;
        }
        
        #logo-container img {
            width: auto;
            max-width: 80%;
            max-height: 8vh;
            object-fit: contain;
        }
        
        #qa-container {
            grid-area: qa;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 0;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        #prize-ladder {
            grid-area: prize;
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 5px;
            max-height: 15vh;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        #prize-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: row;
            justify-content: flex-start;
            gap: 5px;
            height: 100%;
        }
        
        #prize-list li {
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 5px 8px;
            font-family: 'Orbitron', sans-serif;
            color: rgba(255,255,255,0.7);
            transition: all 0.3s ease;
            border-radius: 5px;
            font-size: clamp(0.6rem, 3vw, 0.8rem);
            white-space: nowrap;
            min-width: 80px;
        }
        
        #prize-list li.current {
            background-color: var(--orange-select);
            color: var(--main-blue);
            font-weight: 700;
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--orange-select);
        }
        
        #prize-list li span:first-child {
            color: var(--gold);
            margin-right: 5px;
        }
        
        #level-title {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1.1rem, 5vw, 1.5rem);
            color: var(--gold);
            margin: 5px 0;
            text-shadow: 0 0 8px var(--gold);
        }
        
        #question-box {
            width: 95%;
            height: auto;
            min-height: 70px;
            background: linear-gradient(180deg, var(--main-blue), var(--dark-blue));
            border: 2px solid var(--gold);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: clamp(0.9rem, 4vw, 1.2rem);
            padding: 12px;
            margin-bottom: 10px;
            clip-path: polygon(0% 50%, 5% 0%, 95% 0%, 100% 50%, 95% 100%, 5% 100%);
        }
        
        #options-grid {
            width: 95%;
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .option-box {
            background: linear-gradient(180deg, var(--main-blue), var(--dark-blue));
            border: 2px solid var(--gold);
            color: #fff;
            font-size: clamp(0.9rem, 3.8vw, 1.1rem);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            padding: 10px 15px;
            clip-path: polygon(0% 50%, 8% 0%, 92% 0%, 100% 50%, 92% 100%, 8% 100%);
            touch-action: manipulation;
        }
        
        #lives-display {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: clamp(0.9rem, 4vw, 1.1rem);
            font-family: 'Orbitron';
            z-index: 5;
        }
        
        #lives-display span {
            font-size: clamp(1rem, 4vw, 1.3rem);
            margin-left: 3px;
            color: var(--red-incorrect);
            text-shadow: 0 0 5px var(--red-incorrect);
        }
        
        /* Animaciones optimizadas para m贸viles */
        .option-box:hover {
            background: var(--light-blue);
        }
        
        .option-prefix {
            color: var(--orange-select);
            font-family: 'Orbitron', sans-serif;
            margin-right: 10px;
        }
        
        .option-box.selected {
            background: var(--orange-select);
            color: var(--main-blue);
            font-weight: bold;
            animation: pulse-select 1.2s infinite;
        }
        
        .option-box.correct {
            background: var(--green-correct);
            animation: flash-correct 1s;
        }
        
        .option-box.incorrect {
            background: var(--red-incorrect);
            animation: shake-incorrect 0.5s;
        }
        
        @keyframes pulse-select {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes flash-correct {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes shake-incorrect {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* Pantalla final */
        #leaderboard-container {
            margin-top: 15px;
            width: 95%;
            max-width: 600px;
            text-align: left;
        }
        
        #leaderboard-list {
            list-style: none;
            padding: 0;
            margin: 10px 0;
        }
        
        #leaderboard-list li {
            background: rgba(0,0,0,0.3);
            padding: 8px 12px;
            border-radius: 5px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            font-weight: 500;
            font-size: clamp(0.8rem, 3.5vw, 1rem);
        }
        
        #leaderboard-list li.current-player {
            background: var(--gold);
            color: var(--main-blue);
            font-weight: 700;
        }
        
        #final-rank {
            font-size: clamp(1rem, 4.5vw, 1.2rem);
            color: var(--gold);
            margin-top: 5px;
            font-weight: 700;
        }
        
        /* Media queries para tablets y pantallas m谩s grandes */
        @media (min-width: 600px) {
            #game-screen {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto 1fr;
                grid-template-areas: 
                    "logo prize"
                    "qa prize";
                gap: 15px;
                padding: 15px;
            }
            
            #prize-ladder {
                max-height: none;
                overflow-x: visible;
            }
            
            #prize-list {
                flex-direction: column-reverse;
                gap: 0;
                height: auto;
            }
            
            #prize-list li {
                padding: 8px 12px;
                font-size: clamp(0.7rem, 2vw, 0.9rem);
                justify-content: flex-start;
                min-width: auto;
            }
            
            #prize-list li span:first-child {
                margin-right: 10px;
            }
            
            #options-grid {
                grid-template-columns: 1fr 1fr;
                gap: 12px;
            }
            
            #logo-container img {
                max-height: 12vh;
            }
        }
        
        @media (min-width: 768px) {
            #game-screen {
                grid-template-columns: 1fr 250px;
                grid-template-rows: 100px 1fr;
            }
            
            #qa-container {
                justify-content: center;
            }
            
            #logo-container img {
                max-height: 100px;
                max-width: 80%;
            }
            
            #prize-list li {
                padding: 0 15px;
                font-size: 1rem;
            }
            
            .btn {
                padding: 15px 30px;
            }
        }
        
        /* Orientaci贸n landscape */
        @media (max-height: 500px) and (orientation: landscape) {
            #game-screen {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto 1fr;
                grid-template-areas: 
                    "logo prize"
                    "qa prize";
            }
            
            #prize-ladder {
                max-height: none;
            }
            
            #prize-list {
                flex-direction: column-reverse;
                gap: 0;
            }
            
            #options-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            #logo-container img {
                max-height: 12vh;
            }
            
            #question-box, .option-box {
                min-height: 60px;
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="intro-screen" class="screen active"> 
            <div id="start-overlay"><button class="btn">Hacer Clic para Empezar</button></div> 
            <video id="intro-video" src="https://somnozzz.cl/wp-content/uploads/2025/06/QQSM.mp4" muted playsinline></video> 
        </div>
        <div id="welcome-screen" class="screen">
            <h1>QUIN QUIERE SER<br><span>ENFERMERO</span></h1>
            <p>Ingresa tus datos para comenzar. Tienes 3 intentos.</p>
            <form id="register-form">
                <input type="text" id="player-name" class="welcome-input" placeholder="Tu Nombre y Apellido" required>
                <input type="text" id="player-service" class="welcome-input" placeholder="Tu Servicio / rea de Trabajo" required>
                <button type="submit" id="start-btn" class="btn">隆Comenzar a Jugar!</button>
            </form>
        </div>
        <div id="game-screen-wrapper" class="screen"> 
            <div id="lives-display"></div> 
            <div id="game-screen"> 
                <div id="logo-container"><img src="https://somnozzz.cl/wp-content/uploads/2025/06/QQSM.png" alt="Logo del Juego"></div> 
                <div id="qa-container">
                    <h2 id="level-title"></h2>
                    <div id="question-box"></div>
                    <div id="options-grid"></div>
                </div> 
                <div id="prize-ladder"><ol id="prize-list" reversed></ol></div> 
            </div> 
        </div>
        <div id="end-screen" class="screen"> 
            <h2 id="end-message"></h2> 
            <p id="final-score"></p> 
            <p id="final-rank"></p> 
            <div id="leaderboard-container"> 
                <h2> Top 10 Jugadores </h2> 
                <ol id="leaderboard-list"></ol> 
                <button id="restart-btn" class="btn">Jugar de Nuevo</button> 
            </div> 
        </div>
    </div>
    
    <!-- Sonidos optimizados para m贸viles -->
    <audio id="intro-sound" src="https://somnozzz.cl/wp-content/uploads/2025/06/Pregunta-Quien-quiere-ser-millonario_-Sound-Effect.mp3" preload="auto"></audio>
    <audio id="question-start-sound" src="https://www.myinstants.com/media/sounds/empezar-pregunta-quien-quiere-ser-millonario.mp3" preload="auto"></audio>
    <audio id="background-music" src="https://somnozzz.cl/wp-content/uploads/2025/06/Quien-Quiere-Ser-Millonario-Efecto-de-Sonido.mp3" preload="auto" loop></audio>
    <audio id="correct-sound" src="https://www.myinstants.com/media/sounds/es-correcto.mp3" preload="auto"></audio>
    <audio id="incorrect-sound" src="https://www.myinstants.com/media/sounds/sonido-de-error-de-windows-xp-fatal-error.mp3" preload="auto"></audio>

    <script>
        // --> URL DEFINITIVA INTEGRADA <--
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxCKsjvfq6yPEMfLoFgQmTmOUVaYaLFVj2RJTYLVOnU0El9fIoK-hNs4PDTLXJlOFCc/exec";

        // --> BANCO DE PREGUNTAS CORREGIDO Y VERIFICADO MANUALMENTE <--
        const FULL_QUESTION_BANK = [
            // I. DRENAJE TORCICO Y PLEUROSTOMA
            { question: "驴Cu谩l es la raz贸n fisiol贸gica principal para colocar una pleurostom铆a en el 5掳 espacio intercostal, l铆nea medio axilar?", options: ["Es la zona m谩s pr贸xima al diafragma.", "Facilitar la movilizaci贸n del paciente.", "Corresponde a una zona segura y accesible con menor riesgo de da帽ar estructuras vasculares.", "Mejora la adherencia pulmonar."], correct: 2 },
            { question: "驴Qu茅 elemento debe verificarse de forma continua en un sistema de drenaje con sello de agua?", options: ["La presencia de burbujas persistentes en la c谩mara de succi贸n.", "El nivel de oxigenaci贸n del paciente.", "La fluctuaci贸n (swinging) en la columna de agua del sello.", "El color del tubo de drenaje."], correct: 2 },
            { question: "驴Cu谩l es una indicaci贸n cl铆nica para sospechar una fuga a茅rea persistente en un paciente con pleurostom铆a?", options: ["Aumento de la presi贸n venosa central.", "Dolor tor谩cico durante la inspiraci贸n.", "Presencia constante de burbujeo en el sello de agua durante la espiraci贸n.", "Disminuci贸n del gasto urinario."], correct: 2 },
            { question: "驴Cu谩l es el principal riesgo de aplicar una presi贸n negativa excesiva en un sistema de drenaje tor谩cico?", options: ["Desplazamiento del tubo de drenaje.", "Infecci贸n del sitio de inserci贸n.", "Colapso del pulm贸n contralateral.", "Lesi贸n al tejido pulmonar por succi贸n excesiva."], correct: 3 },
            { question: "驴Qu茅 caracter铆stica distingue un sello seco de un sello de agua en los sistemas de drenaje tor谩cico?", options: ["Requiere cambio diario.", "No permite la movilizaci贸n del paciente.", "No necesita columna l铆quida para funcionar como v谩lvula antirretorno.", "Es menos efectivo en neumot贸rax."], correct: 2 },
            { question: "驴Cu谩l es un beneficio cl铆nico documentado de la movilizaci贸n temprana en pacientes con pleurostom铆a?", options: ["Previene la acumulaci贸n de secreciones en el tubo.", "Aumenta la duraci贸n del uso del tubo tor谩cico.", "Mejora la reexpansi贸n pulmonar y la funci贸n respiratoria.", "Evita el uso de antibi贸ticos profil谩cticos."], correct: 2 },
            { question: "驴Qu茅 criterio es necesario cumplir antes de retirar un tubo de pleurostom铆a?", options: ["Disminuci贸n del dolor tor谩cico.", "Ausencia de burbujeo y menos de 200 ml de drenaje en 24 horas.", "Saturaci贸n de ox铆geno superior al 90%.", "Ausencia de secreciones en el tubo."], correct: 1 },
            { question: "驴Cu谩l es la presi贸n negativa est谩ndar recomendada para el sistema de succi贸n continua en una pleurostom铆a?", options: ["-10 cmHO", "-20 cmHO", "-30 cmHO", "-40 cmHO"], correct: 1 },
            // II. SEDOANALGESIA Y FARMACOLOGA
            { question: "驴Qu茅 factor farmacocin茅tico del propofol justifica su suspensi贸n antes de realizar pruebas neurol贸gicas en pacientes ventilados?", options: ["Su metabolismo renal y acumulaci贸n en caso de falla renal.", "Su larga vida media terminal y acumulaci贸n tisular.", "Su acci贸n sobre los receptores GABA-A.", "Su interacci贸n con la noradrenalina en perfusi贸n."], correct: 1 },
            { question: "驴Qu茅 combinaci贸n de drogas vasoactivas se considera segura en la misma l铆nea Y, siempre que se usa soluci贸n salina como diluyente?", options: ["Noradrenalina y dopamina.", "Adrenalina y bicarbonato de sodio.", "Dobutamina y midazolam.", "Propofol y noradrenalina."], correct: 0 },
            { question: "驴Cu谩l de los siguientes f谩rmacos utilizados en sedoanalgesia puede inducir s铆ndrome de infusi贸n prolongada si se usa m谩s all谩 de 48 horas a dosis altas?", options: ["Fentanilo", "Propofol", "Midazolam", "Ketamina"], correct: 1 },
            { question: "Paciente adulto de 72 kg, con fiebre persistente postoperatoria, requiere manejo antipir茅tico y se indica paracetamol IV. 驴Cu谩l es una precauci贸n clave al administrar paracetamol endovenoso?", options: ["Se debe diluir en 100 ml de soluci贸n salina y administrar en bolo r谩pido.", "La infusi贸n debe completarse en no menos de 15 minutos para evitar hipotensi贸n.", "Solo puede administrarse por v铆a subcut谩nea o intramuscular.", "No debe administrarse en pacientes con fiebre posoperatoria por riesgo de hepatotoxicidad."], correct: 1 },
            // III. ACCESOS VASCULARES
            { question: "En un paciente con shock hipovol茅mico, se requiere infundir soluciones hipert贸nicas y aminas vasoactivas. 驴Cu谩l de las siguientes afirmaciones es correcta respecto al tipo de acceso?", options: ["Puede utilizarse un cat茅ter perif茅rico por 72 horas sin riesgo.", "Se debe insertar un acceso subcut谩neo con bomba elastom茅rica.", "El uso de cat茅ter venoso central es obligatorio por pH y osmolaridad.", "El midline es suficiente si se rotan los sitios cada 24 horas."], correct: 2 },
            { question: "Paciente con tratamiento antibi贸tico de largo plazo recibe vancomicina (pH 2,8, infusi贸n continua). Tiene mala red venosa perif茅rica y requiere infusi贸n por m谩s de 7 d铆as. 驴Qu茅 cat茅ter es el m谩s indicado?", options: ["Cat茅ter venoso perif茅rico.", "L铆nea media.", "Cat茅ter venoso central tipo PICC.", "Cat茅ter de hemodi谩lisis."], correct: 2 },
            { question: "驴Cu谩l de las siguientes caracter铆sticas distingue al cat茅ter midline respecto del PICC en cuanto a ubicaci贸n anat贸mica de la punta?", options: ["Ambos terminan en la vena cava superior.", "El midline finaliza en el tercio distal de la vena bas铆lica o cef谩lica, sin llegar a la cava.", "El PICC se inserta en venas perif茅ricas pero finaliza en aur铆cula derecha.", "El midline se inserta solo en la yugular externa."], correct: 1 },
            { question: "En un paciente con requerimiento de infusi贸n de noradrenalina por m谩s de 48 horas, 驴cu谩l es el acceso vascular m谩s seguro y apropiado?", options: ["Cat茅ter venoso perif茅rico de grueso calibre.", "Cat茅ter l铆nea media.", "Cat茅ter venoso central o PICC con lumen exclusivo.", "Cat茅ter arterial."], correct: 2 },
            { question: "驴Cu谩l de las acciones es cr铆tica antes de utilizar un cat茅ter PICC reci茅n instalado para infusi贸n continua?", options: ["Irrigar con 20 ml de soluci贸n salina.", "Confirmar posici贸n de la punta mediante t茅cnica de ECG intracavitario o imagen radiol贸gica.", "Lavar con heparina y comenzar la infusi贸n de inmediato.", "Retirar el ap贸sito inicial y aplicar uno transparente."], correct: 1 },
            { question: "驴Qu茅 criterio contraindica el uso de cat茅ter midline en un paciente hospitalizado?", options: ["Necesidad de antibi贸ticos intravenosos por 7 d铆as.", "Requiere infusi贸n de soluciones con osmolaridad > 900 mOsm/L.", "No tiene accesos venosos perif茅ricos visibles.", "Es al茅rgico a la clorhexidina."], correct: 1 },
            { question: "驴Cu谩l es la complicaci贸n m谩s frecuente asociada a la inserci贸n de un cat茅ter venoso central en la vena subclavia?", options: ["Flebitis localizada.", "Neumot贸rax.", "Oclusi贸n de l铆nea por precipitaci贸n.", "Trombosis venosa profunda en extremidad inferior."], correct: 1 },
            // IV. SONDAJE VESICAL
            { question: "En un paciente con antecedente de hiperplasia prost谩tica benigna y episodios de retenci贸n urinaria, 驴cu谩l es el factor cl铆nico m谩s determinante para optar por una sonda intermitente en lugar de uno permanente?", options: ["Mayor comodidad del paciente.", "Menor riesgo de infecci贸n urinaria.", "Capacidad para realizar autocateterismo y funci贸n vesical conservada.", "Presencia de hematuria persistente."], correct: 2 },
            { question: "驴Cu谩l es la raz贸n fisiopatol贸gica por la que se desaconseja el uso prolongado de cat茅ter urinario permanente sin indicaci贸n estricta?", options: ["Aumenta la presi贸n intravesical provocando reflujo vesicoureteral.", "Disminuye el tono del detrusor por desuso prolongado.", "Genera alcalinizaci贸n urinaria progresiva.", "Conduce a una hiponatremia secundaria a p茅rdida urinaria."], correct: 1 },
            { question: "En un paciente con cat茅ter urinario permanente, 驴qu茅 condici贸n indicar铆a una obstrucci贸n por incrustaci贸n cr贸nica del cat茅ter?", options: ["Diuresis aumentada y orina clara.", "Orina con sangre visible y fiebre s煤bita.", "Dificultad para drenar orina pese a posici贸n correcta y dolor suprap煤bico.", "Hipertensi贸n asociada a retenci贸n urinaria."], correct: 2 },
            { question: "驴Cu谩l es el principio microbiol贸gico que justifica la estricta adherencia a un sistema cerrado en el manejo del cat茅ter urinario permanente?", options: ["Evita el ingreso de bacterias por v铆a hemat贸gena.", "Previene la colonizaci贸n bacteriana ascendente por manipulaci贸n externa.", "Disminuye la excreci贸n de amonio en orina alcalina.", "Impide la formaci贸n de biofilm en el meato urinario."], correct: 1 },
            // V. PREVENCIN Y CONTROL DE INFECCIONES (IAAS)
            { question: "驴Cu谩l es el objetivo principal de un programa de vigilancia epidemiol贸gica del IAAS?", options: ["Reducir los costos hospitalarios.", "Identificar, controlar y prevenir infecciones asociadas a la atenci贸n sanitaria.", "Cumplir con requisitos legales 煤nicamente.", "Mejorar la satisfacci贸n del usuario."], correct: 1 },
            { question: "Ante un brote de infecci贸n por microorganismo multirresistente, la primera acci贸n de la enfermera de control de infecciones debe ser:", options: ["Informar a los familiares de los pacientes afectados.", "Suspender las cirug铆as programadas.", "Implementar precauciones de aislamiento y notificar al equipo de control de infecciones.", "Cambiar todos los equipos m茅dicos del servicio."], correct: 2 },
            { question: "驴Cu谩l es la frecuencia m铆nima recomendada para la higiene de manos en el personal de salud?", options: ["Al inicio y final del turno.", "Antes y despu茅s del contacto con cada paciente.", "Solo cuando las manos est谩n visiblemente sucias.", "Cada 2 horas durante el turno."], correct: 1 },
            { question: "Los medidas de intervenciones de prevenci贸n de IAAS se caracterizan por:", options: ["Ser medidas individuales aplicadas por separado.", "Conjunto de intervenciones basadas en evidencia aplicadas de forma integral.", "Protocolos opcionales seg煤n criterio del personal.", "Medidas aplicadas solo en pacientes de alto riesgo."], correct: 1 },
            { question: "El indicador m谩s importante para evaluar la efectividad de un programa de control de IAAS es:", options: ["N煤mero de capacitaciones realizadas.", "Cantidad de insumos de higiene consumidos.", "Tasa de incidencia de infecciones asociadas a la atenci贸n sanitaria.", "Tiempo promedio de hospitalizaci贸n."], correct: 2 },
            { question: "驴Cu谩ndo se debe implementar aislamiento por contacto?", options: ["Solo en pacientes con fiebre.", "En infecciones por microorganismos multirresistentes y pat贸genos transmitidos por contacto.", "nicamente en unidades de cuidados intensivos.", "Solo si el paciente lo solicita."], correct: 1 },
            { question: "El EPP (Elementos de Protecci贸n Personal) para precauciones por contacto incluye:", options: ["Solo guantes.", "Guantes, bata y protecci贸n ocular siempre.", "Guantes y bata como m铆nimo, mascarilla seg煤n evaluaci贸n del riesgo.", "nicamente mascarilla N95."], correct: 2 },
            { question: "En aislamiento respiratorio por gotas, el EPP indispensable es:", options: ["Mascarilla quir煤rgica, guantes y protecci贸n ocular.", "Solo mascarilla N95.", "Guantes y bata 煤nicamente.", "Protecci贸n completa con traje impermeable."], correct: 0 },
            // VI. ESTRATEGIA HOSPITAL AMIGO Y ACREDITACIN
            { question: "驴Cu谩l es el objetivo principal de la estrategia Hospital Amigo?", options: ["Reducir los costos operativos del hospital.", "Impulsar la apertura de los establecimientos de salud a la familia y comunidad.", "Aumentar el n煤mero de camas disponibles.", "Mejorar 煤nicamente la infraestructura hospitalaria."], correct: 1 },
            { question: "La estrategia Hospital Amigo se implementa en Chile desde:", options: ["2003", "2006", "2010", "2015"], correct: 1 },
            { question: "驴Cu谩l es una de las caracter铆sticas principales de un Hospital Amigo?", options: ["Horarios de visita restringidos 煤nicamente en horarios de oficina.", "Atenci贸n humanizada, acogedora y participativa hacia los usuarios.", "Prohibici贸n de acompa帽antes durante la hospitalizaci贸n.", "Atenci贸n exclusiva para pacientes privados."], correct: 1 },
            { question: "驴C贸mo se eval煤a si un hospital cumple con los est谩ndares de Hospital Amigo?", options: ["Mediante encuestas solo a los funcionarios.", "A trav茅s de una pauta de chequeo aplicada peri贸dicamente.", "Solo por la satisfacci贸n financiera del establecimiento.", "nicamente por la cantidad de pacientes atendidos."], correct: 1 },
            { question: "驴Cu谩l es el enfoque principal de la estrategia Hospital Amigo en relaci贸n a la familia?", options: ["Limitar la participaci贸n familiar en el cuidado del paciente.", "Fortalecer la relaci贸n del equipo de salud con usuarios y familias.", "Cobrar por las visitas familiares.", "Permitir visitas solo los fines de semana."], correct: 1 },
            { question: "驴Qu茅 es la acreditaci贸n de prestadores institucionales de salud en Chile?", options: ["Un proceso de evaluaci贸n opcional para mejorar la infraestructura.", "Un proceso peri贸dico de evaluaci贸n para verificar el cumplimiento de los est谩ndares de calidad establecidos por el Ministerio de Salud.", "Una certificaci贸n 煤nicamente para hospitales privados.", "Un tr谩mite administrativo para obtener permisos municipales."], correct: 1 },
            { question: "驴Cu谩l es la vigencia de la acreditaci贸n para prestadores institucionales?", options: ["1 a帽o", "2 a帽os", "3 a帽os", "5 a帽os"], correct: 2 },
            { question: "驴Qu茅 instituci贸n fiscaliza a las Entidades Acreditadoras en Chile?", options: ["Ministerio de Salud.", "Superintendencia de Salud.", "FONASA.", "Servicio de Salud correspondiente."], correct: 1 },
            { question: "驴Qu茅 tipo de prestadores pueden someterse al proceso de acreditaci贸n?", options: ["Solo hospitales p煤blicos.", "nicamente cl铆nicas privadas.", "Hospitales, cl铆nicas, centros ambulatorios y laboratorios autorizados por la Autoridad Sanitaria.", "Solo centros de atenci贸n primaria."], correct: 2 },
            { question: "驴Cu谩l es el car谩cter del proceso de acreditaci贸n en Chile actualmente?", options: ["Obligatorio para todos los prestadores.", "Voluntario para los prestadores institucionales.", "Obligatorio solo para hospitales p煤blicos.", "Obligatorio solo para prestadores privados."], correct: 1 },
            { question: "En el proceso de acreditaci贸n para prestadores de atenci贸n cerrada, 驴cu谩l es el costo establecido para hospitales de alta complejidad seg煤n los est谩ndares vigentes?", options: ["150 UTM", "200 UTM", "300 UTM", "500 UTM"], correct: 2 },
            { question: "驴Cu谩l es el requisito previo fundamental que debe cumplir un prestador institucional de atenci贸n cerrada antes de solicitar el proceso de acreditaci贸n?", options: ["Tener convenio con FONASA.", "Haber ejecutado y concluido el proceso de autoevaluaci贸n.", "Contar con certificaci贸n ISO.", "Tener m谩s de 100 camas."], correct: 1 },
            // VII. PREVENCIN DE LESIONES POR PRESIN
            { question: "Seg煤n la Orientaci贸n T茅cnica para la Prevenci贸n de Lesiones por Presi贸n, MINSAL 2023, 驴cu谩l es la intervenci贸n m谩s efectiva para pacientes con movilidad limitada y alto riesgo seg煤n Braden?", options: ["Colch贸n de agua sin reposicionamiento frecuente.", "Almohadas de algod贸n en prominencias 贸seas.", "Reposicionamiento cada 2 horas y superficie especial de redistribuci贸n de presi贸n.", "Cremas antibi贸ticas en sacro cada 4 horas."], correct: 2 },
            { question: "De acuerdo con la Orientaci贸n T茅cnica MINSAL 2023, 驴cu谩ndo se justifica el uso de superficies de alta tecnolog铆a para redistribuci贸n de presi贸n?", options: ["Lesi贸n grado 1 en extremidades.", "Solo p茅rdida de sensibilidad t谩ctil.", "M煤ltiples factores de riesgo y lesi贸n grado 3 o mayor.", "Cuidados paliativos sin lesi贸n visible."], correct: 2 },
            { question: "Seg煤n la Orientaci贸n T茅cnica del MINSAL 2023, 驴qu茅 aspecto gu铆a las intervenciones preventivas de enfermer铆a?", options: ["Edad del paciente.", "Tiempo de hospitalizaci贸n.", "Escala Braden y observaci贸n cl铆nica.", "Preferencia por materiales de cama."], correct: 2 },
            { question: "驴Qu茅 rol asigna la Orientaci贸n T茅cnica MINSAL 2023 al personal de enfermer铆a en prevenci贸n de lesiones por presi贸n?", options: ["Cambios de posici贸n solo con lesiones activas.", "Aplicar ap贸sitos solo bajo orden m茅dica.", "Implementar medidas preventivas y liderar educaci贸n al equipo.", "Supervisar limpieza de colchones."], correct: 2 },
            { question: "驴Cu谩l es la frecuencia m铆nima de reposicionamiento en UCI, seg煤n la Orientaci贸n T茅cnica MINSAL 2023?", options: ["Cada 1 hora.", "Cada 4 horas.", "Cada 2 horas con evaluaci贸n cut谩nea.", "Solo al cambio de turno."], correct: 2 },
            // VIII. MARCO LEGAL Y BENEFICIOS
            { question: "Una enfermera del servicio de medicina realiza turnos exclusivamente diurnos, pero ocasionalmente cubre reemplazos nocturnos en la UTI. 驴Puede acceder a la asignaci贸n de la Ley 19.264?", options: ["S铆, si realiza al menos un turno nocturno al mes.", "No, ya que su destino principal no es una unidad cerrada ni en turno rotativo formal.", "S铆, autom谩ticamente por estar en hospital de alta complejidad.", "Solo si firma una carta de compromiso adicional."], correct: 1 },
            { question: "驴Cu谩l es la finalidad del descanso compensatorio especial de 10 d铆as h谩biles anuales para los profesionales regulados por la Ley 19.264?", options: ["Sustituir el feriado legal de 15 d铆as h谩biles.", "Compensar el desgaste f铆sico y ps铆quico por turnos rotativos en unidades cr铆ticas.", "Otorgar tiempo para capacitaci贸n continua obligatoria.", "Reemplazar el descanso postnatal parental en profesionales varones."], correct: 1 },
            { question: "驴Cu谩l es la consecuencia establecida por la Ley 19.536 para un profesional beneficiario que es sancionado disciplinariamente durante el per铆odo de compensaci贸n?", options: ["Se le suspender谩 el pago del beneficio por tres meses.", "Pierde el derecho a recibir la compensaci贸n desde la fecha de aplicaci贸n de la sanci贸n y por el resto del per铆odo vigente.", "Deber谩 devolver las bonificaciones recibidas anteriormente.", "Se le traslada a otra unidad sin bonificaci贸n."], correct: 1 },
            { question: "Seg煤n la Ley 19.536, 驴cu谩l es uno de los principales objetivos de otorgar esta calificaci贸n al personal de salud?", options: ["Compensar econ贸micamente la escasez de recursos f铆sicos en unidades cr铆ticas.", "Reforzar la estabilidad contractual en establecimientos rurales.", "Reconocer el trabajo en unidades de mayor complejidad y rotaci贸n, como UCI, Neonatolog铆a y Pabell贸n.", "Sustituir los bonos por desempe帽o institucional."], correct: 2 },
            // IX. PROBIDAD ADMINISTRATIVA Y ESTATUTO ADMINISTRATIVO
            { question: "驴Cu谩l de las siguientes situaciones constituye una vulneraci贸n directa al principio de probidad administrativa en un funcionario p煤blico de salud?", options: ["No asistir a una capacitaci贸n voluntaria fuera del horario laboral.", "Aceptar un obsequio de un familiar de un paciente como agradecimiento por la atenci贸n.", "Tomar una pausa para colaci贸n en el horario establecido.", "Informar al equipo m茅dico sobre un error en la prescripci贸n de medicamentos."], correct: 1 },
            { question: "Un encargado de calidad en un hospital modifica los datos de cumplimiento de indicadores asistenciales para que el servicio aparezca con un rendimiento superior al real. 驴Qu茅 infracci贸n se configura seg煤n el Estatuto Administrativo?", options: ["Optimizaci贸n de datos para resguardar la imagen institucional.", "Faltas menores por ajustes metodol贸gicos.", "Manipulaci贸n de informaci贸n oficial, constituyendo una falta grave a la probidad administrativa.", "Acci贸n v谩lida si es autorizada verbalmente por la jefatura."], correct: 2 },
            { question: "Una enfermera jefe de pabell贸n autoriza reiteradamente la compra de insumos a una empresa en la que trabaja su cu帽ado, sin participar directamente en las ventas. 驴Qu茅 principio es vulnerable a esta situaci贸n?", options: ["Principio de eficiencia institucional.", "Derecho a la confidencialidad.", "Principio de probidad por conflicto de interes.", "Principio de legalidad presupuestaria."], correct: 2 },
            { question: "驴Qu茅 principio del Estatuto Administrativo debe respetarse al planificar turnos nocturnos y festivos del personal de enfermer铆a?", options: ["Rotaci贸n continua sin horario l铆mite.", "Igualdad en la distribuci贸n de cargas y respeto al descanso compensatorio.", "Exclusi贸n de jefaturas del sistema de turnos.", "Prioridad a los funcionarios de mayor antig眉edad para evitar el desgaste."], correct: 1 },
            { question: "Una enfermera reclama que ha sido reiteradamente asignada a turnos nocturnos, mientras otros colegas no lo son. 驴Qu茅 derecho est谩 siendo potencialmente vulnerado seg煤n el Estatuto Administrativo?", options: ["Derecho al descanso materno.", "Derecho a la neutralidad sindical.", "Derecho a la equidad en la planificaci贸n de turnos y no discriminaci贸n.", "Derecho a solicitar traslado inmediato."], correct: 2 },
            // X. LEY KARIN
            { question: "Seg煤n la Ley Karin, 驴cu谩l es la primera obligaci贸n del empleador ante una denuncia formal de acoso laboral en un establecimiento de salud p煤blica?", options: ["Desvincular inmediatamente al denunciado.", "Realizar una mediaci贸n informal entre las partes.", "Activar el procedimiento interno de investigaci贸n conforme al reglamento y adoptar medidas de resguardo para la persona denunciante.", "Informar a los sindicatos del caso."], correct: 2 },
            { question: "驴Qu茅 medida contempla la Ley Karin para proteger a la persona denunciante durante el proceso investigativo?", options: ["Cambiarla de unidad o servicio, con p茅rdida de asignaciones.", "Suspenderla mientras se realiza la investigaci贸n.", "Mantener la confidencialidad y evitar represalias durante todo el proceso.", "Pedirle que renuncie temporalmente al cargo."], correct: 2 },
            { question: "En el contexto de la Ley Karin, 驴cu谩l de los siguientes ejemplos constituye una manifestaci贸n de acoso laboral reiterado?", options: ["Una correcci贸n t茅cnica puntual en una reuni贸n cl铆nica.", "Una cr铆tica aislada en tono firme del supervisor.", "Humillaciones repetidas ante colegas que afectan la dignidad del funcionario.", "La entrega de un memor谩ndum con instrucciones administrativas."], correct: 2 },
            // XI. ASENF (ASOCIACIN DE ENFERMERAS/OS)
            { question: "驴Cu谩l es uno de los principales roles de ASENF en la defensa de los derechos laborales de las enfermeras del sector p煤blico?", options: ["Negociar remuneraciones individualmente con los socios.", "Representar colectivamente a sus afiliadas ante autoridades del MINSAL y Servicios de Salud en casos de vulneraci贸n de derechos laborales.", "Otorgar certificados de capacitaci贸n v谩lidos para concursos.", "Dirigir exclusivamente procesos disciplinarios internos."], correct: 1 },
            { question: "驴C贸mo puede ASENF intervenir en situaciones de maltrato o acoso laboral hacia una enfermera afiliada?", options: ["Otorgando financiamiento externo para la desvinculaci贸n.", "Asesorando y acompa帽ando el proceso administrativo y/o judicial, y canalizando denuncias ante entes competentes.", "Permitiendo la renuncia a beneficios laborales para evitar conflictos.", "Sustituyendo al empleador en la gesti贸n del caso."], correct: 1 },
            { question: "驴Qu茅 herramienta gremial puede activar ASENF cuando una unidad hospitalaria presenta turnos inadecuados que vulneran el Estatuto Administrativo?", options: ["Solicitud al ministerio para que modifique la dotaci贸n.", "Derivaci贸n directa del caso al Colegio M茅dico.", "Gesti贸n de denuncias colectivas, fiscalizaci贸n y solicitud formal de revisi贸n al Servicio de Salud respectivo.", "Suspensi贸n de las funciones del jefe de unidad."], correct: 2 },
            { question: "En el contexto de las asignaciones especiales (urgencia, cr铆tica, etc.), 驴de qu茅 forma ASENF puede contribuir a garantizar su correcta aplicaci贸n?", options: ["Postulando a los funcionarios directamente.", "Gestionando la resoluci贸n administrativa de pago.", "Supervisando internamente la unidad donde se aplica.", "Monitoreando y exigiendo el cumplimiento de los criterios normativos mediante representaci贸n t茅cnica ante directivos locales y nacionales."], correct: 3 },
            // MONITORIZACIN HEMODINMICA
            { question: "Al observar la curva de presi贸n arterial invasiva, se identifica una forma achatada con descenso de la amplitud y una onda d铆crota poco visible. 驴Cu谩l es la interpretaci贸n m谩s probable?", options: ["Hipertensi贸n arterial severa.", "Colapso del sistema respiratorio.", "Subestimaci贸n de la presi贸n por amortiguaci贸n del sistema o presencia de burbujas.", "Hiperresonancia del transductor."], correct: 2 },
            { question: "Una curva arterial con forma exageradamente picuda y oscilaciones post-s铆stole excesivas (sobreshooting) indica qu茅 alteraciones t茅cnica del sistema?", options: ["Hipotensi贸n severa.", "Resonancia aumentada por un sistema mal amortiguado (hiperdin谩mico).", "Falla del transductor.", "Obstrucci贸n del cat茅ter arterial."], correct: 1 },
            // ELECTROCARDIOGRAFA (ECG)
            { question: "En un ECG trazado de 12 derivaciones, una enfermera identifica una elevaci贸n del segmento ST en DII, DIII y aVF. 驴Qu茅 sospecha cl铆nica debe priorizar?", options: ["Infarto anterior extenso.", "Isquemia subendoc谩rdica global.", "Infarto agudo de miocardio en cara inferior.", "Bloqueo auriculoventricular de primer grado."], correct: 2 },
            { question: "En un ECG, la presencia de ondas P irregulares, sin morfolog铆a definida, acompa帽adas de una frecuencia ventricular irregular, sugiere:", options: ["Taquicardia supraventricular parox铆stica.", "Fibrilaci贸n auricular.", "Fluter auricular.", "Ritmo nodal."], correct: 1 },
            { question: "驴Qu茅 alteraciones electrocardiogr谩ficas es caracter铆stica de la hiperkalemia severa y debe alertar a la enfermera?", options: ["Ondas T invertidas sim茅tricas.", "Prolongaci贸n del intervalo QT.", "Ondas T picudas y acuminadas, con desaparici贸n progresiva de la onda P.", "Bradicardia sinusal con extras铆stoles."], correct: 2 },
            // TERAPIA TROMBOLTICA
            { question: "En un paciente con infarto agudo de miocardio con elevaci贸n del ST (IAMCEST) que no tiene acceso inmediato a angioplast铆a, 驴cu谩l es la ventana de tiempo ideal para administrar tromb贸lisis seg煤n las gu铆as actuales?", options: ["Dentro de las primeras 12 horas desde el inicio de los s铆ntomas.", "Solo despu茅s de las 24 horas si persiste dolor.", "Hasta 36 horas en cualquier paciente sin importar edad.", "Despu茅s de iniciar antiagregaci贸n y heparina."], correct: 0 },
            { question: "驴Cu谩l de las siguientes condiciones representa una contraindicaci贸n absoluta para la tromb贸lisis en un paciente con sospecha de tromboembolismo pulmonar masivo?", options: ["Hipertensi贸n arterial controlada.", "Cirug铆a mayor reciente (煤ltimos 10 d铆as).", "Hemorragia intracraneana previa.", "Uso de anticoagulantes orales."], correct: 2 },
            // REANIMACIN CARDIOPULMONAR (RCP) AVANZADA
            { question: "Durante una RCP avanzada, el ritmo en el monitor es fibrilaci贸n ventricular. 驴Cu谩l es la acci贸n inmediata indicada seg煤n el protocolo ACLS?", options: ["Administrar adrenalina y realizar masaje card铆aco.", "Realizar desfibrilaci贸n inmediata seguida de compresiones.", "Administrar amiodarona y esperar recuperaci贸n.", "Colocar marcapasos externos."], correct: 1 },
            { question: "En un paciente intubado durante paro cardiorrespiratorio, 驴cu谩l es la frecuencia de ventilaci贸n recomendada mientras se realizan compresiones tor谩cicas continuas?", options: ["10 ventilaciones por minuto sin interrumpir compresiones.", "30 compresiones por 2 ventilaciones.", "6 ventilaciones por minuto.", "Una ventilaci贸n cada 10 segundos."], correct: 0 },
            { question: "Durante la RCP, despu茅s de 2 minutos de compresiones y una dosis de adrenalina, se detecta actividad el茅ctrica sin pulso (AESP). 驴Cu谩l es el siguiente paso indicado?", options: ["Administrar una descarga el茅ctrica.", "Continuar RCP y buscar causas reversibles (Hs y Ts).", "Repetir la adrenalina inmediatamente.", "Suspender RCP si hay ritmo."], correct: 1 },
            { question: "驴Cu谩l es el objetivo de mantener una buena calidad de compresiones tor谩cicas durante la RCP avanzada?", options: ["Evitar hipoxia celular y aumentar la perfusi贸n cerebral y coronaria.", "Aumentar la frecuencia card铆aca espont谩nea.", "Reducir el dolor en el t贸rax del paciente.", "Respuesta estimuladora adren茅rgica de los pulmones."], correct: 0 }
        ];

        const allScreens = document.querySelectorAll('.screen'); 
        const welcomeScreen = document.getElementById('welcome-screen'); 
        const gameScreenWrapper = document.getElementById('game-screen-wrapper'); 
        const endScreen = document.getElementById('end-screen'); 
        const registerForm = document.getElementById('register-form'); 
        const restartBtn = document.getElementById('restart-btn'); 
        const livesDisplay = document.getElementById('lives-display'); 
        const levelTitle = document.getElementById('level-title'); 
        const questionBox = document.getElementById('question-box'); 
        const optionsGrid = document.getElementById('options-grid'); 
        const prizeList = document.getElementById('prize-list'); 
        const endMessage = document.getElementById('end-message'); 
        const finalScore = document.getElementById('final-score'); 
        const finalRank = document.getElementById('final-rank'); 
        const leaderboardList = document.getElementById('leaderboard-list'); 
        const backgroundMusic = document.getElementById('background-music'); 
        const questionStartSound = document.getElementById('question-start-sound');
        
        let gameLevels = [], lastQuestionObject = null, currentQuestionObject = {};
        let currentLevel = 0, lives = 3, totalScore = 0, selectedAnswer = false;
        let currentPlayerName = '', currentPlayerService = '';
        
        function playSound(sound) {
            try { 
                sound.currentTime = 0; 
                sound.play(); 
            } catch (e) { 
                console.error("Error al reproducir sonido:", e); 
            }
        }
        
        function stopAllSounds() {
            document.querySelectorAll('audio').forEach(sound => {
                sound.pause();
                sound.currentTime = 0;
            });
        }
        
        function switchScreen(activeScreen) {
            allScreens.forEach(screen => screen.classList.remove('active'));
            activeScreen.classList.add('active');
            
            // Asegurar que la pantalla activa est茅 en la parte superior
            if (activeScreen.scrollIntoView) {
                activeScreen.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
        
        function init() { 
            const startOverlay = document.getElementById('start-overlay'); 
            const introVideo = document.getElementById('intro-video'); 
            
            startOverlay.addEventListener('click', () => { 
                startOverlay.style.display = 'none'; 
                introVideo.muted = false; 
                introVideo.play(); 
            }); 
            
            introVideo.addEventListener('ended', () => switchScreen(welcomeScreen)); 
            introVideo.addEventListener('error', () => switchScreen(welcomeScreen)); 
            
            registerForm.addEventListener('submit', handleRegisterSubmit); 
            restartBtn.addEventListener('click', resetGame); 
            
            // Prevenir zoom en dispositivos m贸viles
            document.addEventListener('gesturestart', function(e) {
                e.preventDefault();
            });
            
            // Prevenir scroll en iOS
            document.addEventListener('touchmove', function(e) {
                if (e.target === document.documentElement || e.target === document.body) {
                    e.preventDefault();
                }
            }, { passive: false });
        }
        
        function resetGame() { 
            currentLevel = 0; 
            lives = 3; 
            totalScore = 0; 
            gameLevels = []; 
            lastQuestionObject = null; 
            document.getElementById('player-name').value = ''; 
            document.getElementById('player-service').value = ''; 
            const startBtn = document.getElementById('start-btn'); 
            startBtn.disabled = false; 
            startBtn.textContent = '隆Comenzar a Jugar!'; 
            switchScreen(welcomeScreen); 
        }
        
        function handleRegisterSubmit(e) { 
            e.preventDefault(); 
            currentPlayerName = document.getElementById('player-name').value; 
            currentPlayerService = document.getElementById('player-service').value; 
            
            if (!currentPlayerName || !currentPlayerService) {
                alert("Por favor, completa tu nombre y servicio.");
                return;
            } 
            
            const startBtn = document.getElementById('start-btn'); 
            startBtn.disabled = true; 
            startBtn.textContent = 'Cargando...'; 
            startGame(); 
        }
        
        function startGame() {
            stopAllSounds();
            playSound(backgroundMusic);
            const shuffledQuestions = [...FULL_QUESTION_BANK].sort(() => 0.5 - Math.random());
            gameLevels = [];
            
            // 8 niveles con 10 preguntas cada uno (total 80)
            const levelDistribution = [10, 10, 10, 10, 10, 10, 10, 10]; 
            
            for (let i = 0; i < 8; i++) { 
                gameLevels.push({
                    level: i + 1, 
                    questions: shuffledQuestions.splice(0, levelDistribution[i])
                });
            }

            currentLevel = 0;
            lives = 3;
            totalScore = 0;
            selectedAnswer = false;
            lastQuestionObject = null;
            prizeList.innerHTML = '';
            
            gameLevels.forEach((levelData) => {
                const li = document.createElement('li');
                li.id = `level-${levelData.level - 1}`;
                li.innerHTML = `<span>${levelData.level}</span> NIVEL ${levelData.level}`;
                prizeList.appendChild(li);
            });
            
            switchScreen(gameScreenWrapper);
            loadQuestion();
        }

        function loadQuestion() { 
            if (currentLevel >= gameLevels.length) {
                winGame();
                return;
            } 
            
            playSound(questionStartSound); 
            selectedAnswer = false; 
            updateHUD(); 
            
            const levelData = gameLevels[currentLevel]; 
            let availableQuestions = levelData.questions; 
            
            if (lastQuestionObject && availableQuestions.length > 1) {
                availableQuestions = availableQuestions.filter(q => q.question !== lastQuestionObject.question);
            } 
            
            const questionIndex = Math.floor(Math.random() * availableQuestions.length); 
            currentQuestionObject = availableQuestions[questionIndex]; 
            questionBox.innerText = currentQuestionObject.question; 
            optionsGrid.innerHTML = ""; 
            
            const prefixes = ['A', 'B', 'C', 'D']; 
            currentQuestionObject.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.classList.add('option-box');
                button.innerHTML = `<span class="option-prefix">${prefixes[index]}:</span> ${option}`;
                button.addEventListener('click', () => selectAnswer(index, button));
                optionsGrid.appendChild(button);
            }); 
        }
        
        function selectAnswer(selectedIndex, button) { 
            if (selectedAnswer) return; 
            
            selectedAnswer = true; 
            if (backgroundMusic) backgroundMusic.volume = 0.3; 
            
            const buttons = optionsGrid.getElementsByTagName('button'); 
            button.classList.add('selected'); 
            
            setTimeout(() => { 
                if (backgroundMusic) backgroundMusic.volume = 1.0; 
                
                if (selectedIndex === currentQuestionObject.correct) { 
                    playSound(document.getElementById('correct-sound')); 
                    button.classList.remove('selected'); 
                    button.classList.add('correct'); 
                    totalScore++; 
                    currentLevel++; 
                    lastQuestionObject = null; 
                    
                    setTimeout(loadQuestion, 1800); 
                } else { 
                    playSound(document.getElementById('incorrect-sound')); 
                    lives--; 
                    lastQuestionObject = currentQuestionObject; 
                    button.classList.remove('selected'); 
                    button.classList.add('incorrect'); 
                    buttons[currentQuestionObject.correct].classList.add('correct'); 
                    
                    setTimeout(() => {
                        if (lives <= 0) {
                            endGame();
                        } else {
                            loadQuestion();
                        }
                    }, 2500); 
                } 
            }, 2000); 
        }
        
        function updateHUD() { 
            livesDisplay.innerHTML = 'Intentos: ' + 'わ'.repeat(lives); 
            levelTitle.innerText = `NIVEL ${currentLevel + 1}`; 
            
            const prizeItems = prizeList.getElementsByTagName('li'); 
            for (let i = 0; i < prizeItems.length; i++) {
                prizeItems[i].classList.remove('current');
            } 
            
            if (currentLevel < gameLevels.length) {
                document.getElementById(`level-${currentLevel}`).classList.add('current');
            } 
        }
        
        function winGame() { 
            handleGameEnd(true); 
        }
        
        function endGame() { 
            handleGameEnd(false); 
        }

        async function handleGameEnd(isWinner) {
            stopAllSounds();
            endMessage.textContent = isWinner ? "隆FELICIDADES, HAS GANADO!" : "隆JUEGO TERMINADO!";
            finalScore.innerText = `Tu puntaje final es: ${totalScore} Puntos`;
            finalRank.textContent = '';
            leaderboardList.innerHTML = "<li>Guardando tu puntaje y actualizando el ranking...</li>";
            switchScreen(endScreen);

            if (isWinner && typeof confetti === 'function') {
                const duration = 2 * 1000; 
                const end = Date.now() + duration;
                
                (function frame() {
                    confetti({particleCount: 2, angle: 60, spread: 55, origin: { x: 0 }});
                    confetti({particleCount: 2, angle: 120, spread: 55, origin: { x: 1 }});
                    if (Date.now() < end) { 
                        requestAnimationFrame(frame); 
                    }
                }());
            }

            const newScoreEntry = { 
                name: currentPlayerName, 
                service: currentPlayerService, 
                score: totalScore, 
                id: Date.now() 
            };

            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(newScoreEntry),
                });

                if (!response.ok) {
                    throw new Error(`Error en la respuesta del servidor: ${response.statusText}`);
                }

                const fullLog = await response.json();
                
                if (fullLog.status === 'error') {
                    throw new Error(`Error en el script de Google: ${fullLog.message}`);
                }
                
                displayLeaderboard(fullLog, newScoreEntry.id);

            } catch (error) {
                console.error("Error detallado al conectar con el ranking:", error);
                leaderboardList.innerHTML = `<li>Hubo un error al conectar con el ranking. Revisa la consola (F12) para m谩s detalles.</li>`;
            }
        }
        
        function displayLeaderboard(fullLog, currentPlayerId) {
            leaderboardList.innerHTML = "";
            const sortedFullLog = [...fullLog].sort((a, b) => b.score - a.score);
            const leaderboardData = sortedFullLog.slice(0, 10);

            if (leaderboardData.length === 0) {
                leaderboardList.innerHTML = "<li>A煤n no hay puntajes. 隆S茅 el primero!</li>";
                finalRank.textContent = "隆Felicitaciones por ser el primero en jugar!";
                return;
            }

            const playerIndex = sortedFullLog.findIndex(score => score.id === currentPlayerId);
            
            if (playerIndex !== -1) {
                const rank = playerIndex + 1;
                finalRank.textContent = `隆Felicidades! Lograste el puesto #${rank}.`;
            } else {
                finalRank.textContent = "隆Buen intento! Sigue jugando para entrar al Top 10.";
            }
            
            leaderboardData.forEach((score, index) => {
                const li = document.createElement('li');
                const scoreText = `${score.score} Puntos`;
                li.innerHTML = `<span>#${index + 1} ${score.name} (${score.service || 'N/A'})</span><span>${scoreText}</span>`;
                
                if (score.id === currentPlayerId) {
                    li.classList.add('current-player');
                }
                
                leaderboardList.appendChild(li);
            });
        }

        // Iniciar el juego cuando el DOM est茅 listo
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            setTimeout(init, 1);
        } else {
            document.addEventListener('DOMContentLoaded', init);
        }
    </script>
</body>
</html>
