<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qui茅n Quiere Ser Enfermero</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        /* CSS (sin cambios) */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@400;500&display=swap');
        :root{--main-blue:#02022d;--dark-blue:#0c0c4c;--light-blue:#1e3a8a;--gold:#ffd700;--orange-select:#f9a825;--green-correct:#28a745;--red-incorrect:#dc3545;}
        html, body { height: 100%; margin: 0; }
        body{font-family:'Roboto',sans-serif;background:radial-gradient(circle, var(--light-blue) 0%, var(--main-blue) 70%);color:#fff;display:flex;justify-content:center;align-items:center;overflow:hidden;}
        .game-container{width:100%;height:100%;background:rgba(0,0,0,0.2);text-align:center;position:relative;display:flex;justify-content:center;align-items:center;}
        .screen{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:opacity 0.5s ease;background:radial-gradient(circle, var(--light-blue) 0%, var(--main-blue) 70%);z-index:10;padding: 15px; box-sizing: border-box;}
        .screen.active{opacity:1;visibility:visible;}
        #intro-screen{z-index:20; background:black; padding: 0;}
        #intro-video{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover; z-index: 21;}
        #start-overlay{position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:22; display:flex; justify-content:center; align-items:center; cursor:pointer;}
        .btn{font-family:'Orbitron',sans-serif;background:linear-gradient(135deg, var(--gold), var(--orange-select));color:var(--main-blue);border:none;padding:15px 30px;font-size:clamp(1rem, 4vw, 1.2rem);font-weight:700;border-radius:50px;cursor:pointer;transition:all 0.3s ease;margin-top:20px;box-shadow:0 4px 15px rgba(255,215,0,0.3);z-index:1;}
        .btn:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 6px 20px rgba(255,215,0,0.5);}
        .btn:disabled{background:#999;cursor:not-allowed;}
        #welcome-screen h1,#end-screen h2{font-family:'Orbitron',sans-serif;font-size:clamp(2rem, 8vw, 3rem);color:var(--gold);text-shadow:0 0 10px var(--gold);z-index:1; margin: 10px 0;}
        #welcome-screen h1 span{display:block;}
        #welcome-screen form{width:90%;max-width:500px;}
        .welcome-input{display:block;width:100%;box-sizing:border-box;margin:15px auto;padding:12px;border-radius:5px;border:1px solid #ccc;font-size:1rem;}
        #game-screen-wrapper{background:none;}
        #game-screen{width:100%;height:100%;display:grid;box-sizing:border-box; grid-template-columns: 1fr; grid-template-rows: auto auto 1fr; grid-template-areas: "prize" "logo" "qa"; gap: 10px; }
        #logo-container{grid-area:logo;display:flex;justify-content:center;align-items:center;}
        #logo-container img{width:auto;max-width:60%;max-height:10vh;object-fit:contain;}
        #qa-container{grid-area:qa;display:flex;flex-direction:column;justify-content:space-evenly;align-items:center; min-height: 0;}
        #prize-ladder{grid-area:prize;background:rgba(0,0,0,0.4);border-radius:10px;padding:5px;}
        #prize-list{list-style:none;padding:0;margin:0;display:flex;flex-direction:row;justify-content:center;gap:5px;height:100%;}
        #prize-list li{flex-grow:1;display:flex;align-items:center;justify-content:center;padding:5px;font-family:'Orbitron',sans-serif;color:rgba(255,255,255,0.7);transition:all 0.3s ease;border-radius:5px; font-size: 0.7rem; white-space: nowrap;}
        #prize-list li.current{background-color:var(--orange-select);color:var(--main-blue);font-weight:700;transform:scale(1.1);box-shadow:0 0 15px var(--orange-select);}
        #prize-list li span:first-child{color:var(--gold);margin-right:5px;}
        #level-title{font-family:'Orbitron',sans-serif;font-size:clamp(1.2rem, 5vw, 1.8rem);color:var(--gold);margin: 10px 0;text-shadow:0 0 8px var(--gold);}
        #question-box{width:95%;height:auto;min-height:80px;background:linear-gradient(180deg, var(--main-blue), var(--dark-blue));border:2px solid var(--gold);border-radius:10px;display:flex;justify-content:center;align-items:center;font-size:clamp(1rem, 4vw, 1.4rem);padding:15px;margin-bottom:15px;clip-path:polygon(0% 50%, 5% 0%, 95% 0%, 100% 50%, 95% 100%, 5% 100%);}
        #options-grid{width:95%;display:grid;grid-template-columns:1fr;gap:10px;}
        .option-box{background:linear-gradient(180deg, var(--main-blue), var(--dark-blue));border:2px solid var(--gold);color:#fff;font-size:clamp(0.9rem, 3.5vw, 1.2rem);border-radius:10px;cursor:pointer;transition:all 0.2s ease;text-align:left;padding:12px 20px;clip-path:polygon(0% 50%, 8% 0%, 92% 0%, 100% 50%, 92% 100%, 8% 100%);}
        #lives-display{position:absolute;top:15px;left:15px;font-size:1.2rem;font-family:'Orbitron';}
        #lives-display span{font-size:1.5rem;margin-left:5px;color:var(--red-incorrect);text-shadow:0 0 5px var(--red-incorrect);}
        @media (min-width: 768px) { #game-screen { grid-template-columns: 1fr 250px; grid-template-rows: 120px 1fr; grid-template-areas: "logo prize" "qa   prize"; gap: 20px; padding: 20px; } #qa-container { justify-content: center; } #logo-container img { max-height: 100px; max-width: 80%; } #prize-list { flex-direction:column-reverse; gap:0;} #prize-list li { padding: 0 15px; font-size: 1rem; justify-content: flex-start;} #prize-list li span:first-child { margin-right: 15px; } #options-grid { grid-template-columns: 1fr 1fr; gap:15px; } }
        .option-box:hover{background:var(--light-blue);}.option-prefix{color:var(--orange-select);font-family:'Orbitron',sans-serif;margin-right:15px;}.option-box.selected{background:var(--orange-select);color:var(--main-blue);font-weight:bold;animation:pulse-select 1.2s infinite;}.option-box.correct{background:var(--green-correct);animation:flash-correct 1s;}.option-box.incorrect{background:var(--red-incorrect);animation:shake-incorrect 0.5s;}@keyframes pulse-select{0%,100%{transform:scale(1);}50%{transform:scale(1.02);}}@keyframes flash-correct{0%,100%{opacity:1;}50%{opacity:0.3;}}@keyframes shake-incorrect{0%,100%{transform:translateX(0);}10%,30%,50%,70%,90%{transform:translateX(-8px);}20%,40%,60%,80%{transform:translateX(8px);}}
        #leaderboard-container{margin-top:20px;width:90%;max-width:600px;text-align:left;}#leaderboard-list{list-style:none;padding:0;}#leaderboard-list li{background:rgba(0,0,0,0.3);padding:10px 15px;border-radius:5px;margin-bottom:8px;display:flex;justify-content:space-between;font-weight:500; font-size: clamp(0.8rem, 3vw, 1rem);}#leaderboard-list li.current-player{background:var(--gold);color:var(--main-blue);font-weight:700;}#final-rank{font-size:clamp(1rem, 4vw, 1.3rem);color:var(--gold);margin-top:5px;font-weight:700;}
    </style>
</head>
<body>
    <div class="game-container">
        <!-- HTML sin cambios -->
        <div id="intro-screen" class="screen active"> <div id="start-overlay"><button class="btn">Hacer Clic para Empezar</button></div> <video id="intro-video" src="https://somnozzz.cl/wp-content/uploads/2025/06/QQSM.mp4" muted playsinline></video> </div>
        <div id="welcome-screen" class="screen"><h1>QUIN QUIERE SER<br><span>ENFERMERO</span></h1><p>Ingresa tus datos para comenzar. Tienes 3 intentos.</p><form id="register-form"><input type="text" id="player-name" class="welcome-input" placeholder="Tu Nombre y Apellido" required><input type="text" id="player-service" class="welcome-input" placeholder="Tu Servicio / rea de Trabajo" required><button type="submit" id="start-btn" class="btn">隆Comenzar a Jugar!</button></form></div>
        <div id="game-screen-wrapper" class="screen"> <div id="lives-display"></div> <div id="game-screen"> <div id="logo-container"><img src="https://somnozzz.cl/wp-content/uploads/2025/06/QQSM.png" alt="Logo del Juego"></div> <div id="qa-container"><h2 id="level-title"></h2><div id="question-box"></div><div id="options-grid"></div></div> <div id="prize-ladder"><ol id="prize-list" reversed></ol></div> </div> </div>
        <div id="end-screen" class="screen"> <h2 id="end-message"></h2> <p id="final-score"></p> <p id="final-rank"></p> <div id="leaderboard-container"> <h2> Top 10 Jugadores </h2> <ol id="leaderboard-list"></ol> <button id="restart-btn" class="btn">Jugar de Nuevo</button> </div> </div>
    </div>
    <audio id="intro-sound" src="https://somnozzz.cl/wp-content/uploads/2025/06/Pregunta-Quien-quiere-ser-millonario_-Sound-Effect.mp3" preload="auto"></audio><audio id="question-start-sound" src="https://www.myinstants.com/media/sounds/empezar-pregunta-quien-quiere-ser-millonario.mp3" preload="auto"></audio><audio id="background-music" src="https://somnozzz.cl/wp-content/uploads/2025/06/Quien-Quiere-Ser-Millonario-Efecto-de-Sonido.mp3" preload="auto" loop></audio><audio id="correct-sound" src="https://www.myinstants.com/media/sounds/es-correcto.mp3" preload="auto"></audio><audio id="incorrect-sound" src="https://www.myinstants.com/media/sounds/sonido-de-error-de-windows-xp-fatal-error.mp3" preload="auto"></audio>

    <script>
        const GOOGLE_SCRIPT_URL = "PEGA_AQUI_TU_URL_DEL_SCRIPT_DE_GOOGLE";

        // Banco de 80 preguntas (sin cambios)
        const FULL_QUESTION_BANK = [
            { question: "驴Raz贸n fisiol贸gica para pleurostom铆a en 5掳 espacio intercostal, l铆nea medio axilar?", options: ["Zona m谩s pr贸xima al diafragma", "Facilitar movilizaci贸n del paciente", "Zona segura y accesible con menor riesgo vascular", "Mejora adherencia pulmonar"], correct: 2 },
            { question: "驴Qu茅 se verifica continuamente en un drenaje con sello de agua?", options: ["Burbujas persistentes en c谩mara de succi贸n", "Nivel de oxigenaci贸n del paciente", "Fluctuaci贸n (swinging) en columna de agua", "Color del tubo de drenaje"], correct: 2 },
            { question: "Indicaci贸n cl铆nica de fuga a茅rea persistente en pleurostom铆a:", options: ["Aumento de presi贸n venosa central", "Dolor tor谩cico durante inspiraci贸n", "Burbujeo constante en sello de agua en espiraci贸n", "Disminuci贸n del gasto urinario"], correct: 2 },
            { question: "Principal riesgo de presi贸n negativa excesiva en drenaje tor谩cico:", options: ["Desplazamiento del tubo", "Infecci贸n del sitio de inserci贸n", "Colapso del pulm贸n contralateral", "Lesi贸n al tejido pulmonar por succi贸n excesiva"], correct: 3 },
            { question: "驴Qu茅 distingue un sello seco de un sello de agua en drenajes tor谩cicos?", options: ["Requiere cambio diario", "No permite movilizaci贸n", "No necesita columna l铆quida para v谩lvula antirretorno", "Es menos efectivo en neumot贸rax"], correct: 2 },
            { question: "Beneficio de movilizaci贸n temprana en pacientes con pleurostom铆a:", options: ["Previene acumulaci贸n de secreciones", "Aumenta duraci贸n del uso del tubo", "Mejora reexpansi贸n pulmonar y funci贸n respiratoria", "Evita uso de antibi贸ticos profil谩cticos"], correct: 2 },
            { question: "驴Qu茅 criterio es necesario cumplir antes de retirar un tubo de pleurostom铆a?", options: ["Disminuci贸n del dolor tor谩cico", "Ausencia de burbujeo y < 200 ml de drenaje en 24h", "Saturaci贸n de O2 > 90%", "Ausencia de secreciones en el tubo"], correct: 1 },
            { question: "驴Presi贸n negativa est谩ndar para succi贸n continua en pleurostom铆a?", options: ["-10 cmHO", "-20 cmHO", "-30 cmHO", "-40 cmHO"], correct: 1 },
            { question: "驴Qu茅 factor del propofol justifica suspenderlo antes de pruebas neurol贸gicas?", options: ["Metabolismo renal", "Larga vida media y acumulaci贸n tisular", "Acci贸n sobre receptores GABA-A", "Interacci贸n con noradrenalina"], correct: 1 },
            { question: "驴Qu茅 combinaci贸n de drogas vasoactivas es segura en la misma l铆nea Y (con suero salino)?", options: ["Noradrenalina y dopamina", "Adrenalina y bicarbonato de sodio", "Dobutamina y midazolam", "Propofol y noradrenalina"], correct: 0 },
            { question: "驴Qu茅 f谩rmaco puede inducir s铆ndrome de infusi贸n prolongada si se usa > 48h a dosis altas?", options: ["Fentanilo", "Propofol", "Midazolam", "Ketamina"], correct: 1 },
            { question: "Precauci贸n clave al administrar paracetamol IV a paciente con fiebre postoperatoria:", options: ["Diluir en 100 ml y administrar en bolo r谩pido", "Infusi贸n en no menos de 15 min para evitar hipotensi贸n", "Solo por v铆a subcut谩nea o intramuscular", "No administrar por riesgo de hepatotoxicidad"], correct: 1 },
            { question: "En shock hipovol茅mico con soluciones hipert贸nicas, 驴qu茅 acceso es correcto?", options: ["Cat茅ter perif茅rico por 72h sin riesgo", "Acceso subcut谩neo con bomba", "Cat茅ter venoso central por pH y osmolaridad", "Midline si se rota cada 24h"], correct: 2 },
            { question: "Paciente con vancomicina (pH 2.8) por >7 d铆as y mala red venosa, 驴qu茅 cat茅ter se indica?", options: ["Cat茅ter venoso perif茅rico", "L铆nea media", "Cat茅ter venoso central tipo PICC", "Cat茅ter de hemodi谩lisis"], correct: 2 },
            { question: "驴Qu茅 distingue un cat茅ter midline de un PICC en cuanto a ubicaci贸n de la punta?", options: ["Ambos terminan en vena cava superior", "Midline finaliza en tercio distal de vena bas铆lica/cef谩lica", "PICC finaliza en aur铆cula derecha", "Midline se inserta solo en yugular externa"], correct: 1 },
            { question: "Para infusi贸n de noradrenalina por >48h, 驴cu谩l es el acceso m谩s seguro?", options: ["Cat茅ter venoso perif茅rico grueso", "Cat茅ter l铆nea media", "Cat茅ter venoso central o PICC con lumen exclusivo", "Cat茅ter arterial"], correct: 2 },
            { question: "Acci贸n cr铆tica antes de usar un cat茅ter PICC reci茅n instalado:", options: ["Irrigar con 20 ml de soluci贸n salina", "Confirmar posici贸n de la punta con imagen", "Lavar con heparina y comenzar infusi贸n", "Retirar ap贸sito inicial y aplicar transparente"], correct: 1 },
            { question: "驴Qu茅 criterio contraindica el uso de cat茅ter midline en un hospitalizado?", options: ["Necesidad de ATB IV por 7 d铆as", "Infusi贸n de soluciones con osmolaridad > 900 mOsm/L", "No tiene accesos venosos perif茅ricos visibles", "Es al茅rgico a la clorhexidina"], correct: 1 },
            { question: "Complicaci贸n m谩s frecuente asociada a inserci贸n de cat茅ter venoso central en vena subclavia:", options: ["Flebitis localizada", "Neumot贸rax", "Oclusi贸n de l铆nea por precipitaci贸n", "Trombosis venosa profunda en extremidad"], correct: 1 },
            { question: "Factor determinante para optar por sonda intermitente en vez de permanente en hiperplasia prost谩tica:", options: ["Mayor comodidad del paciente", "Menor riesgo de infecci贸n urinaria", "Capacidad para autocateterismo y funci贸n vesical conservada", "Presencia de hematuria persistente"], correct: 2 },
            { question: "Raz贸n fisiopatol贸gica para no usar cat茅ter urinario permanente sin indicaci贸n estricta:", options: ["Aumenta presi贸n intravesical y reflujo", "Disminuye tono del detrusor por desuso", "Genera alcalinizaci贸n urinaria", "Conduce a hiponatremia"], correct: 1 },
            { question: "驴Qu茅 indicar铆a una obstrucci贸n cr贸nica por incrustaci贸n en un cat茅ter urinario permanente?", options: ["Diuresis aumentada y orina clara", "Orina con sangre visible y fiebre s煤bita", "Dificultad para drenar orina pese a posici贸n correcta", "Hipertensi贸n asociada a retenci贸n"], correct: 2 },
            { question: "Principio microbiol贸gico que justifica adherencia estricta a sistema cerrado en cat茅ter urinario:", options: ["Evita ingreso de bacterias por v铆a hemat贸gena", "Previene colonizaci贸n bacteriana ascendente", "Disminuye excreci贸n de amonio", "Impide formaci贸n de biofilm"], correct: 1 },
            { question: "Objetivo principal de un programa de vigilancia epidemiol贸gica del IAAS:", options: ["Reducir costos hospitalarios", "Identificar, controlar y prevenir infecciones", "Cumplir con requisitos legales", "Mejorar satisfacci贸n del usuario"], correct: 1 },
            { question: "Ante un brote de microorganismo multirresistente, la primera acci贸n de la enfermera de control de infecciones es:", options: ["Informar a familiares", "Suspender cirug铆as", "Implementar precauciones de aislamiento y notificar", "Cambiar todos los equipos m茅dicos"], correct: 2 },
            { question: "Frecuencia m铆nima recomendada para higiene de manos del personal de salud:", options: ["Al inicio y final del turno", "Antes y despu茅s del contacto con cada paciente", "Solo cuando las manos est谩n visiblemente sucias", "Cada 2 horas durante el turno"], correct: 1 },
            { question: "Las medidas de intervenciones de prevenci贸n de IAAS se caracterizan por ser:", options: ["Medidas individuales aplicadas por separado", "Conjunto de intervenciones basadas en evidencia", "Protocolos opcionales", "Medidas aplicadas solo en pacientes de alto riesgo"], correct: 1 },
            { question: "Indicador m谩s importante para evaluar la efectividad de un programa de control de IAAS:", options: ["N煤mero de capacitaciones", "Cantidad de insumos consumidos", "Tasa de incidencia de infecciones asociadas", "Tiempo promedio de hospitalizaci贸n"], correct: 2 },
            { question: "驴Cu谩ndo se debe implementar aislamiento por contacto?", options: ["Solo en pacientes con fiebre", "En infecciones por microorganismos multirresistentes", "nicamente en UCI", "Solo si el paciente lo solicita"], correct: 1 },
            { question: "El EPP para precauciones por contacto incluye como m铆nimo:", options: ["Solo guantes", "Guantes, bata y protecci贸n ocular siempre", "Guantes y bata; mascarilla seg煤n riesgo", "nicamente mascarilla N95"], correct: 2 },
            { question: "En aislamiento respiratorio por gotas, el EPP indispensable es:", options: ["Mascarilla quir煤rgica, guantes y protecci贸n ocular", "Solo mascarilla N95", "Guantes y bata 煤nicamente", "Protecci贸n completa con traje impermeable"], correct: 0 },
            { question: "Objetivo principal de la estrategia Hospital Amigo:", options: ["Reducir costos operativos", "Impulsar apertura a la familia y comunidad", "Aumentar n煤mero de camas", "Mejorar infraestructura"], correct: 1 },
            { question: "驴Desde cu谩ndo se implementa la estrategia Hospital Amigo en Chile?", options: ["2003", "2006", "2010", "2015"], correct: 1 },
            { question: "Caracter铆stica principal de un Hospital Amigo:", options: ["Horarios de visita restringidos", "Atenci贸n humanizada, acogedora y participativa", "Prohibici贸n de acompa帽antes", "Atenci贸n exclusiva para privados"], correct: 1 },
            { question: "驴C贸mo se eval煤a si un hospital cumple con est谩ndares de Hospital Amigo?", options: ["Encuestas solo a funcionarios", "A trav茅s de una pauta de chequeo peri贸dica", "Por satisfacci贸n financiera", "Por cantidad de pacientes"], correct: 1 },
            { question: "Enfoque principal de Hospital Amigo en relaci贸n a la familia:", options: ["Limitar participaci贸n familiar", "Fortalecer relaci贸n equipo-familia", "Cobrar por visitas", "Permitir visitas solo fines de semana"], correct: 1 },
            { question: "驴Qu茅 es la acreditaci贸n de prestadores institucionales de salud en Chile?", options: ["Proceso opcional", "Proceso peri贸dico para verificar cumplimiento de est谩ndares", "Certificaci贸n solo para privados", "Tr谩mite para permisos municipales"], correct: 1 },
            { question: "Vigencia de la acreditaci贸n para prestadores institucionales:", options: ["1 a帽o", "2 a帽os", "3 a帽os", "5 a帽os"], correct: 2 },
            { question: "驴Qu茅 instituci贸n fiscaliza a las Entidades Acreditadoras en Chile?", options: ["Ministerio de Salud", "Superintendencia de Salud", "FONASA", "Servicio de Salud correspondiente"], correct: 1 },
            { question: "驴Qu茅 tipo de prestadores pueden someterse al proceso de acreditaci贸n?", options: ["Solo hospitales p煤blicos", "nicamente cl铆nicas privadas", "Hospitales, cl铆nicas, centros autorizados por Autoridad Sanitaria", "Solo centros de atenci贸n primaria"], correct: 2 },
            { question: "Car谩cter del proceso de acreditaci贸n en Chile actualmente:", options: ["Obligatorio para todos", "Voluntario para prestadores institucionales", "Obligatorio solo para hospitales p煤blicos", "Obligatorio solo para prestadores privados"], correct: 1 },
            { question: "Costo de acreditaci贸n para hospitales de alta complejidad seg煤n est谩ndares vigentes:", options: ["150 UTM", "200 UTM", "300 UTM", "500 UTM"], correct: 2 },
            { question: "Requisito previo fundamental para que un prestador solicite acreditaci贸n:", options: ["Convenio con FONASA", "Haber concluido proceso de autoevaluaci贸n", "Certificaci贸n ISO", "Tener m谩s de 100 camas"], correct: 1 },
            { question: "Intervenci贸n m谩s efectiva para pacientes con movilidad limitada y alto riesgo Braden:", options: ["Colch贸n de agua sin reposicionamiento", "Almohadas de algod贸n", "Reposicionamiento cada 2h y superficie especial", "Cremas antibi贸ticas en sacro"], correct: 2 },
            { question: "Seg煤n MINSAL 2023, 驴cu谩ndo se justifica el uso de superficies de alta tecnolog铆a?", options: ["Lesi贸n grado 1", "Solo p茅rdida de sensibilidad", "M煤ltiples factores de riesgo y lesi贸n grado 3 o mayor", "Cuidados paliativos sin lesi贸n"], correct: 2 },
            { question: "Seg煤n MINSAL 2023, 驴qu茅 aspecto gu铆a las intervenciones preventivas de enfermer铆a en LPP?", options: ["Edad del paciente", "Tiempo de hospitalizaci贸n", "Escala Braden y observaci贸n cl铆nica", "Preferencia por materiales"], correct: 2 },
            { question: "Rol que asigna la Orientaci贸n T茅cnica MINSAL 2023 a enfermer铆a en prevenci贸n de LPP:", options: ["Cambios de posici贸n solo con lesiones activas", "Aplicar ap贸sitos solo bajo orden m茅dica", "Implementar medidas preventivas y liderar educaci贸n", "Supervisar limpieza de colchones"], correct: 2 },
            { question: "Frecuencia m铆nima de reposicionamiento en UCI seg煤n la Orientaci贸n T茅cnica MINSAL 2023:", options: ["Cada 1 hora", "Cada 4 horas", "Cada 2 horas con evaluaci贸n cut谩nea", "Solo al cambio de turno"], correct: 2 },
            { question: "Una enfermera diurna cubre reemplazos nocturnos en UTI, 驴puede acceder a la asignaci贸n Ley 19.264?", options: ["S铆, si realiza al menos un turno nocturno al mes", "No, su destino principal no es unidad cerrada", "S铆, autom谩ticamente por estar en alta complejidad", "Solo si firma compromiso adicional"], correct: 1 },
            { question: "Finalidad del descanso compensatorio de 10 d铆as (Ley 19.264):", options: ["Sustituir feriado legal", "Compensar desgaste por turnos en unidades cr铆ticas", "Tiempo para capacitaci贸n", "Reemplazar descanso postnatal"], correct: 1 },
            { question: "Consecuencia para profesional sancionado durante per铆odo de compensaci贸n (Ley 19.536):", options: ["Suspensi贸n de pago por tres meses", "Pierde derecho a compensaci贸n desde la fecha de sanci贸n", "Deber谩 devolver bonificaciones", "Traslado a otra unidad"], correct: 1 },
            { question: "Objetivo principal de la calificaci贸n al personal de salud (Ley 19.536):", options: ["Compensar escasez de recursos", "Reforzar estabilidad contractual", "Reconocer trabajo en unidades de mayor complejidad", "Sustituir bonos por desempe帽o"], correct: 2 },
            { question: "Situaci贸n que vulnera la probidad administrativa de un funcionario p煤blico:", options: ["No asistir a capacitaci贸n voluntaria", "Aceptar un obsequio de un familiar", "Tomar pausa para colaci贸n", "Informar error de prescripci贸n"], correct: 1 },
            { question: "Encargado de calidad modifica indicadores para mejor rendimiento, 驴qu茅 infracci贸n comete?", options: ["Optimizaci贸n de datos", "Faltas menores", "Manipulaci贸n de informaci贸n oficial (falta grave)", "Acci贸n v谩lida si es autorizada verbalmente"], correct: 2 },
            { question: "Enfermera jefe autoriza compras a empresa de su cu帽ado, 驴qu茅 principio es vulnerable?", options: ["Eficiencia institucional", "Confidencialidad", "Probidad por conflicto de inter茅s", "Legalidad presupuestaria"], correct: 2 },
            { question: "Principio del Estatuto Administrativo a respetar al planificar turnos nocturnos y festivos:", options: ["Rotaci贸n continua sin l铆mite", "Igualdad en distribuci贸n de cargas y respeto al descanso", "Exclusi贸n de jefaturas", "Prioridad a mayor antig眉edad"], correct: 1 },
            { question: "Enfermera reclama asignaci贸n reiterada a turnos nocturnos, 驴qu茅 derecho se vulnera?", options: ["Descanso materno", "Neutralidad sindical", "Equidad en planificaci贸n de turnos", "Solicitar traslado inmediato"], correct: 2 },
            { question: "Primera obligaci贸n del empleador ante denuncia de acoso laboral (Ley Karin):", options: ["Desvincular al denunciado", "Realizar mediaci贸n informal", "Activar procedimiento interno y adoptar medidas de resguardo", "Informar a sindicatos"], correct: 2 },
            { question: "Medida que contempla Ley Karin para proteger al denunciante:", options: ["Cambiarlo de unidad", "Suspenderlo mientras se investiga", "Mantener confidencialidad y evitar represalias", "Pedirle que renuncie"], correct: 2 },
            { question: "Ejemplo que constituye acoso laboral reiterado seg煤n Ley Karin:", options: ["Correcci贸n t茅cnica puntual", "Cr铆tica aislada en tono firme", "Humillaciones repetidas ante colegas", "Entrega de memor谩ndum"], correct: 2 },
            { question: "Rol principal de ASENF en defensa de derechos laborales del sector p煤blico:", options: ["Negociar remuneraciones individuales", "Representar colectivamente a afiliadas ante autoridades", "Otorgar certificados de capacitaci贸n", "Dirigir procesos disciplinarios"], correct: 1 },
            { question: "驴C贸mo puede ASENF intervenir en maltrato o acoso hacia una enfermera afiliada?", options: ["Otorgando financiamiento para desvinculaci贸n", "Asesorando y acompa帽ando el proceso judicial", "Permitiendo renuncia a beneficios", "Sustituyendo al empleador"], correct: 1 },
            { question: "Herramienta gremial que puede activar ASENF ante turnos inadecuados:", options: ["Solicitud al ministerio para modificar dotaci贸n", "Derivaci贸n al Colegio M茅dico", "Gesti贸n de denuncias colectivas y fiscalizaci贸n", "Suspensi贸n de funciones del jefe"], correct: 2 },
            { question: "驴De qu茅 forma ASENF garantiza correcta aplicaci贸n de asignaciones especiales?", options: ["Postulando a los funcionarios", "Gestionando resoluci贸n de pago", "Supervisando internamente la unidad", "Monitoreando y exigiendo cumplimiento de criterios normativos"], correct: 3 },
            { question: "驴Caracter铆stica que distingue cat茅ter midline de PICC en ubicaci贸n de punta? (Repetida)", options: ["Ambos en vena cava superior", "Midline finaliza en vena bas铆lica/cef谩lica", "PICC finaliza en aur铆cula derecha", "Midline solo en yugular externa"], correct: 1 },
            { question: "Para infusi贸n de noradrenalina >48h, 驴acceso m谩s seguro? (Repetida)", options: ["Perif茅rico grueso", "L铆nea media", "Central o PICC con lumen exclusivo", "Arterial"], correct: 2 },
            { question: "Acci贸n cr铆tica antes de usar un PICC reci茅n instalado (Repetida):", options: ["Irrigar con 20ml", "Confirmar posici贸n con imagen", "Lavar con heparina", "Retirar ap贸sito"], correct: 1 },
            { question: "驴Criterio que contraindica uso de midline? (Repetida)", options: ["ATB por 7 d铆as", "Soluciones con osmolaridad > 900 mOsm/L", "Sin accesos perif茅ricos", "Alergia a clorhexidina"], correct: 1 },
            { question: "Complicaci贸n m谩s frecuente de CVC en vena subclavia (Repetida):", options: ["Flebitis", "Neumot贸rax", "Oclusi贸n", "Trombosis venosa profunda"], correct: 1 },
            { question: "Curva arterial achatada con onda d铆crota poco visible, 驴interpretaci贸n probable?", options: ["Hipertensi贸n severa", "Colapso respiratorio", "Subestimaci贸n por amortiguaci贸n o burbujas", "Hiperresonancia del transductor"], correct: 2 },
            { question: "Curva arterial con 'sobreshooting' indica 驴qu茅 alteraci贸n t茅cnica?", options: ["Hipotensi贸n severa", "Sistema mal amortiguado (hiperdin谩mico)", "Falla del transductor", "Obstrucci贸n del cat茅ter arterial"], correct: 1 },
            { question: "ECG con elevaci贸n ST en DII, DIII y aVF, 驴qu茅 sospecha priorizar?", options: ["Infarto anterior extenso", "Isquemia subendoc谩rdica global", "Infarto agudo de miocardio en cara inferior", "Bloqueo AV de primer grado"], correct: 2 },
            { question: "ECG con ondas P irregulares, sin morfolog铆a definida y frec. ventricular irregular, sugiere:", options: ["Taquicardia supraventricular parox铆stica", "Fibrilaci贸n auricular", "Fluter auricular", "Ritmo nodal"], correct: 1 },
            { question: "Alteraci贸n en ECG caracter铆stica de hiperkalemia severa:", options: ["Ondas T invertidas sim茅tricas", "Prolongaci贸n del QT", "Ondas T picudas y acuminadas, con desaparici贸n de P", "Bradicardia sinusal con extras铆stoles"], correct: 2 },
            { question: "Ventana de tiempo ideal para administrar tromb贸lisis en IAMCEST sin acceso a angioplast铆a:", options: ["Dentro de las primeras 12 horas", "Despu茅s de 24h si persiste dolor", "Hasta 36 horas", "Despu茅s de iniciar antiagregaci贸n"], correct: 0 },
            { question: "Contraindicaci贸n absoluta para tromb贸lisis en sospecha de TEP masivo:", options: ["Hipertensi贸n controlada", "Cirug铆a mayor reciente (煤ltimos 10 d铆as)", "Hemorragia intracraneana previa", "Uso de anticoagulantes orales"], correct: 2 },
            { question: "En RCP, ritmo de fibrilaci贸n ventricular, 驴acci贸n inmediata seg煤n ACLS?", options: ["Adrenalina y masaje", "Desfibrilaci贸n inmediata seguida de compresiones", "Amiodarona y esperar", "Colocar marcapasos"], correct: 1 },
            { question: "Frecuencia de ventilaci贸n recomendada en paciente intubado durante RCP con compresiones cont铆nuas:", options: ["10 ventilaciones/min sin interrumpir", "30 compresiones por 2 ventilaciones", "6 ventilaciones/min", "Una ventilaci贸n cada 10 seg"], correct: 0 },
            { question: "En RCP, tras 2 min y adrenalina, se detecta AESP. 驴Siguiente paso?", options: ["Administrar descarga", "Continuar RCP y buscar causas reversibles", "Repetir adrenalina", "Suspender RCP si hay ritmo"], correct: 1 },
            { question: "Objetivo de mantener buena calidad de compresiones tor谩cicas en RCP avanzada:", options: ["Evitar hipoxia y aumentar perfusi贸n cerebral", "Aumentar frecuencia card铆aca espont谩nea", "Reducir dolor en t贸rax", "Respuesta estimuladora adren茅rgica"], correct: 0 }
        ];

        // --- Resto del script ---
        const allScreens = document.querySelectorAll('.screen'); const welcomeScreen = document.getElementById('welcome-screen'); const gameScreenWrapper = document.getElementById('game-screen-wrapper'); const endScreen = document.getElementById('end-screen'); const registerForm = document.getElementById('register-form'); const restartBtn = document.getElementById('restart-btn'); const livesDisplay = document.getElementById('lives-display'); const levelTitle = document.getElementById('level-title'); const questionBox = document.getElementById('question-box'); const optionsGrid = document.getElementById('options-grid'); const prizeList = document.getElementById('prize-list'); const endMessage = document.getElementById('end-message'); const finalScore = document.getElementById('final-score'); const finalRank = document.getElementById('final-rank'); const leaderboardList = document.getElementById('leaderboard-list'); const backgroundMusic = document.getElementById('background-music'); const questionStartSound = document.getElementById('question-start-sound');
        let gameLevels = [], lastQuestionObject = null, currentQuestionObject = {};
        let currentLevel = 0, lives = 3, totalScore = 0, selectedAnswer = false;
        let currentPlayerName = '', currentPlayerService = '';
        function playSound(sound){try { sound.currentTime=0; sound.play(); } catch (e) { console.error("Error al reproducir sonido:", e); }}
        function stopAllSounds(){document.querySelectorAll('audio').forEach(sound=>{sound.pause();sound.currentTime=0;});}
        function switchScreen(activeScreen){allScreens.forEach(screen=>screen.classList.remove('active'));activeScreen.classList.add('active');}
        
        function init() {
            const startOverlay = document.getElementById('start-overlay');
            const introVideo = document.getElementById('intro-video');
            startOverlay.addEventListener('click', () => {
                startOverlay.style.display = 'none';
                introVideo.muted = false;
                introVideo.play();
            });
            introVideo.addEventListener('ended', () => switchScreen(welcomeScreen));
            introVideo.addEventListener('error', () => switchScreen(welcomeScreen));
            registerForm.addEventListener('submit', handleRegisterSubmit);
            restartBtn.addEventListener('click', resetGame);
        }

        function resetGame() { currentLevel=0; lives=3; totalScore=0; gameLevels=[]; lastQuestionObject=null; document.getElementById('player-name').value=''; document.getElementById('player-service').value=''; const startBtn=document.getElementById('start-btn'); startBtn.disabled=false; startBtn.textContent='隆Comenzar a Jugar!'; switchScreen(welcomeScreen); }
        function handleRegisterSubmit(e) { e.preventDefault(); currentPlayerName=document.getElementById('player-name').value; currentPlayerService=document.getElementById('player-service').value; if (!currentPlayerName||!currentPlayerService){alert("Por favor, completa tu nombre y servicio.");return;} const startBtn=document.getElementById('start-btn'); startBtn.disabled=true; startBtn.textContent='Cargando...'; startGame(); }
        
        // --> FUNCIN startGame ACTUALIZADA PARA 8 NIVELES CON 2 PREGUNTAS C/U
        function startGame() { 
            stopAllSounds(); 
            playSound(backgroundMusic); 
            const shuffledQuestions=[...FULL_QUESTION_BANK].sort(()=>0.5-Math.random());
            gameLevels=[]; 
            const questionsPerLevel = 2;
            const numLevels = 8;

            for (let i=0; i < numLevels; i++) {
                gameLevels.push({
                    level: i + 1, 
                    questions: shuffledQuestions.splice(0, questionsPerLevel)
                });
            }
            
            currentLevel=0; lives=3; totalScore=0; selectedAnswer=false; lastQuestionObject=null; 
            prizeList.innerHTML=''; 
            gameLevels.forEach((levelData)=>{
                const li=document.createElement('li');
                li.id=`level-${levelData.level-1}`;
                li.innerHTML=`<span>${levelData.level}</span>N${levelData.level}`; // Texto m谩s corto para m贸vil
                prizeList.appendChild(li);
            }); 
            switchScreen(gameScreenWrapper); 
            loadQuestion(); 
        }

        function loadQuestion() { if (currentLevel>=gameLevels.length){winGame();return;} playSound(questionStartSound); selectedAnswer=false; updateHUD(); const levelData=gameLevels[currentLevel]; let availableQuestions=levelData.questions; if(lastQuestionObject&&availableQuestions.length>1){availableQuestions=availableQuestions.filter(q=>q.question!==lastQuestionObject.question);} const questionIndex=Math.floor(Math.random()*availableQuestions.length); currentQuestionObject=availableQuestions[questionIndex]; questionBox.innerText=currentQuestionObject.question; optionsGrid.innerHTML=""; const prefixes=['A','B','C','D']; currentQuestionObject.options.forEach((option,index)=>{const button=document.createElement('button');button.classList.add('option-box');button.innerHTML=`<span class="option-prefix">${prefixes[index]}:</span> ${option}`;button.addEventListener('click',()=>selectAnswer(index,button));optionsGrid.appendChild(button);}); }
        function selectAnswer(selectedIndex,button) { if(selectedAnswer)return; selectedAnswer=true; if(backgroundMusic)backgroundMusic.volume=0.3; const buttons=optionsGrid.getElementsByTagName('button'); button.classList.add('selected'); setTimeout(()=>{ if(backgroundMusic)backgroundMusic.volume=1.0; if(selectedIndex===currentQuestionObject.correct){ playSound(document.getElementById('correct-sound')); button.classList.remove('selected'); button.classList.add('correct'); totalScore++; currentLevel++; lastQuestionObject=null; setTimeout(loadQuestion,1800); } else { playSound(document.getElementById('incorrect-sound')); lives--; lastQuestionObject=currentQuestionObject; button.classList.remove('selected'); button.classList.add('incorrect'); buttons[currentQuestionObject.correct].classList.add('correct'); setTimeout(()=>{if(lives<=0){endGame();}else{loadQuestion();}},2500); } },2000); }
        function updateHUD() { livesDisplay.innerHTML='Intentos: '+'わ'.repeat(lives); levelTitle.innerText=`NIVEL ${currentLevel+1}`; const prizeItems=prizeList.getElementsByTagName('li'); for(let i=0;i<prizeItems.length;i++){prizeItems[i].classList.remove('current');} if(currentLevel<gameLevels.length){document.getElementById(`level-${currentLevel}`).classList.add('current');} }
        function winGame() { handleGameEnd(true); }
        function endGame() { handleGameEnd(false); }

        async function handleGameEnd(isWinner) {
            stopAllSounds();
            endMessage.textContent = isWinner ? "隆FELICIDADES, HAS GANADO!" : "隆JUEGO TERMINADO!";
            finalScore.innerText = `Tu puntaje final es: ${totalScore} Puntos`;
            finalRank.textContent = '';
            leaderboardList.innerHTML = "<li>Guardando tu puntaje y actualizando el ranking...</li>";
            switchScreen(endScreen);

            if (isWinner && typeof confetti === 'function') {
                const duration = 2 * 1000; const end = Date.now() + duration;
                (function frame() {
                    confetti({particleCount: 2, angle: 60, spread: 55, origin: { x: 0 }});
                    confetti({particleCount: 2, angle: 120, spread: 55, origin: { x: 1 }});
                    if (Date.now() < end) { requestAnimationFrame(frame); }
                }());
            }

            const newScoreEntry = { name: currentPlayerName, service: currentPlayerService, score: totalScore, id: Date.now() };

            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify(newScoreEntry)
                });
                await new Promise(resolve => setTimeout(resolve, 2000));
                const response = await fetch(GOOGLE_SCRIPT_URL);
                if (!response.ok) { throw new Error(`Error al leer el ranking: ${response.statusText}`); }
                const fullLog = await response.json();
                displayLeaderboard(fullLog, newScoreEntry.id);
            } catch (error) {
                console.error("Error detallado al conectar con el ranking:", error);
                leaderboardList.innerHTML = `<li>Hubo un error al conectar con el ranking. Aseg煤rate de que la URL del script sea correcta y que el script est茅 publicado correctamente.</li>`;
            }
        }
        
        function displayLeaderboard(fullLog, currentPlayerId) {
            leaderboardList.innerHTML = "";
            const leaderboardData = [...fullLog].sort((a, b) => b.puntaje - a.puntaje).slice(0, 10);
            if (leaderboardData.length === 0) {
                leaderboardList.innerHTML = "<li>A煤n no hay puntajes.</li>";
                finalRank.textContent = "隆Felicitaciones por ser el primero!";
                return;
            }
            const playerIndex = leaderboardData.findIndex(score => score.id === currentPlayerId);
            if (playerIndex !== -1) {
                const rank = playerIndex + 1;
                finalRank.textContent = `隆Lograste el puesto #${rank} en el Top 10!`;
            } else {
                finalRank.textContent = "隆Buen intento! Sigue jugando para entrar al Top 10.";
            }
            leaderboardData.forEach((score, index) => {
                const li = document.createElement('li');
                const scoreText = `${score.puntaje} Puntos`;
                li.innerHTML = `<span>#${index + 1} ${score.nombre} (${score.servicio || ''})</span><span>${scoreText}</span>`;
                if (score.id === currentPlayerId) {
                    li.classList.add('current-player');
                }
                leaderboardList.appendChild(li);
            });
        }
        init();
    </script>
</body>
</html>
